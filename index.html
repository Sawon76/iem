<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KUET IEM - Industrial Study Hub</title>
    <meta name="description" content="A centralized industrial study hub for KUET IEM students to access study materials, questions, books, and resources.">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <!-- Babel for JSX transformation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body { font-family: 'Inter', sans-serif; }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: rgba(255, 255, 255, 0.1); border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: rgba(255, 255, 255, 0.2); }
        
        /* Animations */
        .modal-enter { animation: modalIn 0.3s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        @keyframes modalIn { from { opacity: 0; transform: scale(0.95) translateY(10px); } to { opacity: 1; transform: scale(1) translateY(0); } }

        .animate-fadeIn { animation: fadeIn 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* Ambient Background Blobs */
        .ambient-blob {
            position: fixed;
            border-radius: 50%;
            filter: blur(80px);
            z-index: 0;
            opacity: 0.4;
            animation: float 20s infinite ease-in-out;
            pointer-events: none;
        }
        .blob-1 { top: -10%; left: -10%; width: 50vw; height: 50vw; background: radial-gradient(circle, rgba(56, 189, 248, 0.3) 0%, transparent 70%); animation-delay: 0s; }
        .blob-2 { bottom: -20%; right: -10%; width: 60vw; height: 60vw; background: radial-gradient(circle, rgba(139, 92, 246, 0.3) 0%, transparent 70%); animation-delay: -5s; }
        .blob-3 { top: 40%; left: 40%; width: 40vw; height: 40vw; background: radial-gradient(circle, rgba(16, 185, 129, 0.2) 0%, transparent 70%); animation-delay: -10s; }

        @keyframes float {
            0% { transform: translate(0, 0) scale(1); }
            33% { transform: translate(30px, -50px) scale(1.1); }
            66% { transform: translate(-20px, 20px) scale(0.9); }
            100% { transform: translate(0, 0) scale(1); }
        }
    </style>

    <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@18.2.0",
    "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
    "lucide-react": "https://esm.sh/lucide-react@0.292.0",
    "react-dom/": "https://esm.sh/react-dom@^19.2.3/",
    "react/": "https://esm.sh/react@^19.2.3/"
  }
}
</script>
</head>
<body class="bg-[#050505] text-[#e7ecf3] selection:bg-cyan-500/30 selection:text-cyan-100 min-h-screen overflow-x-hidden relative">
    <div class="ambient-blob blob-1"></div>
    <div class="ambient-blob blob-2"></div>
    <div class="ambient-blob blob-3"></div>
    <div id="root" class="relative z-10"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useMemo, useRef } from 'react';
        import { createRoot } from 'react-dom/client';
        import { 
            Book, PenTool, HardDrive, ArrowUp, 
            Download, User, Heart, Share2, Check,
            X, Search, FolderOpen, ExternalLink, Loader2, BookOpen, Eye, Server, Library, AlertTriangle, CheckCircle, HelpCircle, ArrowRight, Bell, Calendar,
            Pencil, Upload, Lock, Unlock, Trash2, RotateCcw, ChevronLeft, ChevronRight, FileText, Layout,
            Filter, Zap, ChevronDown, Sparkles, Users, Phone, Key, Globe, Database
        } from 'lucide-react';

        // --- CONSTANTS ---
        const GITHUB_CONFIG = {
            owner: "Sawon76",
            repo: "iem",
            branch: "main"
        };

        const YEARS = ['1st Year', '2nd Year', '3rd Year', '4th Year'];
        const SEMESTERS = ['1st Semester', '2nd Semester'];
        const CATEGORIES = ['Study Material', 'Term Questions', 'CT Questions', 'Lab Manual', 'Books'];
        const DRIVE_TERMS = ['1st Term', '2nd Term'];

        const getCategoryStyles = (category) => {
            switch (category) {
                case 'Study Material': return {
                    emoji: 'ðŸ“–',
                    btnGradient: 'bg-[linear-gradient(145deg,#ff8a3d,#d95c1e)]',
                };
                case 'Term Questions': return {
                    emoji: 'ðŸ§¾',
                    btnGradient: 'bg-[linear-gradient(145deg,#22c55e,#15803d)]',
                };
                case 'CT Questions': return {
                    emoji: 'ðŸ“',
                    btnGradient: 'bg-[linear-gradient(145deg,#a78bfa,#6d28d9)]',
                };
                case 'Lab Manual': return {
                    emoji: 'ðŸ§ª',
                    btnGradient: 'bg-[linear-gradient(145deg,#f43f5e,#be123c)]',
                };
                case 'Books': return {
                    emoji: 'ðŸ“š',
                    btnGradient: 'bg-[linear-gradient(145deg,#3b82f6,#1d4ed8)]',
                };
                default: return {
                    emoji: 'ðŸ“',
                    btnGradient: 'bg-[linear-gradient(145deg,#64748b,#475569)]',
                };
            }
        };

        // --- SERVICES ---
        
        const bookService = {
            searchBooks: async (query) => {
                try {
                    const res = await fetch(`https://www.googleapis.com/books/v1/volumes?q=${encodeURIComponent(query)}&maxResults=24`);
                    const data = await res.json();
                    return (data.items || []).map(item => ({
                        id: item.id,
                        title: item.volumeInfo.title,
                        authors: item.volumeInfo.authors || ['Unknown'],
                        thumbnail: item.volumeInfo.imageLinks?.thumbnail?.replace('http:', 'https:') || null,
                        link: item.volumeInfo.previewLink,
                        year: item.volumeInfo.publishedDate?.substring(0, 4) || 'N/A',
                        publisher: item.volumeInfo.publisher
                    }));
                } catch (error) {
                    console.error("Book search failed", error);
                    return [];
                }
            }
        };

        function utf8_to_b64(str) {
            return window.btoa(unescape(encodeURIComponent(str)));
        }

        function b64_to_utf8(str) {
            return decodeURIComponent(escape(window.atob(str)));
        }

        async function githubAPI(endpoint, token, method = 'GET', body = null) {
            const headers = {
                'Accept': 'application/vnd.github.v3+json',
            };
            if (token) {
                headers['Authorization'] = `token ${token}`;
            }

            const options = { method, headers };
            if (body) options.body = JSON.stringify(body);

            const res = await fetch(`https://api.github.com${endpoint}`, options);
            if (!res.ok) throw new Error(`GitHub API Error: ${res.status}`);
            return res.json();
        }

        const githubService = {
            getUser: async (token) => {
                return githubAPI('/user', token);
            },

            fetchFileContent: async (fileName, token) => {
                try {
                    if (token) {
                        const file = await githubAPI(`/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/contents/${fileName}`, token);
                        return JSON.parse(b64_to_utf8(file.content));
                    } else {
                        const url = `https://raw.githubusercontent.com/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/${GITHUB_CONFIG.branch}/${fileName}?t=${Date.now()}`;
                        const res = await fetch(url, { cache: "no-store" });
                        if (res.ok) return await res.json();
                    }
                    return [];
                } catch (err) {
                    if (err.message && err.message.includes('404')) {
                        return [];
                    }
                    console.error(`Error fetching ${fileName}`, err);
                    return [];
                }
            },

            saveFileContent: async (fileName, contentData, message, token) => {
                let sha = null;
                try {
                    const current = await githubAPI(`/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/contents/${fileName}`, token);
                    sha = current.sha;
                } catch (e) {
                    // File might not exist yet
                }

                await githubAPI(`/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/contents/${fileName}`, token, 'PUT', {
                    message: message,
                    content: utf8_to_b64(JSON.stringify(contentData, null, 2)),
                    sha: sha
                });
            },

            uploadFile: async (fileData, fileName, token) => {
                const base64Content = fileData.split(',')[1];
                const path = `uploads/${Date.now()}_${fileName.replace(/\s/g, '_')}`;
                await githubAPI(`/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/contents/${path}`, token, 'PUT', {
                    message: `Upload ${fileName}`,
                    content: base64Content
                });
                return `https://raw.githubusercontent.com/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/${GITHUB_CONFIG.branch}/${path}`;
            }
        };

        // --- COMPONENTS ---

        // Interactive Grid
        const InteractiveGrid = () => {
            const canvasRef = useRef(null);

            useEffect(() => {
                const canvas = canvasRef.current;
                if (!canvas) return;

                const ctx = canvas.getContext('2d');
                if (!ctx) return;

                let width = 0, height = 0;
                let mouseX = -1000, mouseY = -1000;
                const squareSize = 40;
                let animationFrameId;

                const resize = () => {
                    if (!canvas.parentElement) return;
                    const rect = canvas.parentElement.getBoundingClientRect();
                    width = rect.width;
                    height = rect.height;
                    canvas.width = width;
                    canvas.height = height;
                };

                const handleMouseMove = (e) => {
                    if (!canvas.parentElement) return;
                    const rect = canvas.parentElement.getBoundingClientRect();
                    const skewRad = 12 * (Math.PI / 180);
                    const skewOffset = (e.clientX - (window.innerWidth / 2)) * Math.tan(skewRad);
                    mouseX = e.clientX - rect.left;
                    mouseY = (e.clientY - rect.top) - skewOffset;
                };

                const draw = () => {
                    ctx.clearRect(0, 0, width, height);
                    const cols = Math.ceil(width / squareSize);
                    const rows = Math.ceil(height / squareSize);

                    ctx.strokeStyle = "rgba(255, 255, 255, 0.05)";
                    ctx.lineWidth = 1;
                    ctx.beginPath();
                    for (let i = 0; i <= cols; i++) {
                        ctx.moveTo(i * squareSize, 0);
                        ctx.lineTo(i * squareSize, height);
                    }
                    for (let j = 0; j <= rows; j++) {
                        ctx.moveTo(0, j * squareSize);
                        ctx.lineTo(width, j * squareSize);
                    }
                    ctx.stroke();

                    if (mouseX > 0 && mouseY > 0) {
                        const hoverCol = Math.floor(mouseX / squareSize);
                        const hoverRow = Math.floor(mouseY / squareSize);
                        ctx.fillStyle = "rgba(100, 150, 255, 0.2)";
                        ctx.fillRect(hoverCol * squareSize + 1, hoverRow * squareSize + 1, squareSize - 2, squareSize - 2);
                        ctx.fillStyle = "rgba(100, 150, 255, 0.05)";
                        ctx.fillRect(hoverCol * squareSize + 1, (hoverRow - 1) * squareSize + 1, squareSize - 2, squareSize - 2);
                        ctx.fillRect(hoverCol * squareSize + 1, (hoverRow + 1) * squareSize + 1, squareSize - 2, squareSize - 2);
                        ctx.fillRect((hoverCol - 1) * squareSize + 1, hoverRow * squareSize + 1, squareSize - 2, squareSize - 2);
                        ctx.fillRect((hoverCol + 1) * squareSize + 1, hoverRow * squareSize + 1, squareSize - 2, squareSize - 2);
                    }
                    animationFrameId = requestAnimationFrame(draw);
                };

                window.addEventListener('resize', resize);
                window.addEventListener('mousemove', handleMouseMove);
                
                resize();
                draw();

                return () => {
                    window.removeEventListener('resize', resize);
                    window.removeEventListener('mousemove', handleMouseMove);
                    cancelAnimationFrame(animationFrameId);
                };
            }, []);

            return (
                <div className="fixed top-[-50%] left-0 right-0 h-[200%] transform skew-y-12 z-0 pointer-events-none opacity-50"
                    style={{
                        maskImage: 'radial-gradient(600px circle at center, white, transparent)',
                        WebkitMaskImage: 'radial-gradient(600px circle at center, white, transparent)'
                    }}
                >
                    <canvas ref={canvasRef} className="w-full h-full" />
                </div>
            );
        };

        // Skeleton
        const CardSkeleton = () => (
            <div className="relative flex flex-col bg-[#151a22] border border-white/5 rounded-[18px] overflow-hidden h-48 animate-pulse">
                <div className="p-6 flex-1 space-y-4">
                    <div className="flex items-center gap-3">
                        <div className="w-10 h-10 rounded-lg bg-white/5"></div>
                        <div className="h-4 w-24 bg-white/5 rounded"></div>
                    </div>
                    <div className="h-px bg-white/5 w-full my-4"></div>
                    <div className="space-y-2">
                        <div className="h-3 w-1/3 bg-white/5 rounded"></div>
                        <div className="h-5 w-3/4 bg-white/5 rounded"></div>
                    </div>
                </div>
                <div className="h-12 bg-white/5 w-full"></div>
            </div>
        );

        const NoticeSkeleton = () => (
            <div className="w-full h-24 rounded-[18px] bg-[#151a22] border border-white/5 animate-pulse"></div>
        );

        // Material Card
        const MaterialCard = ({ material, compact = false, isSaved, onToggleSave }) => {
            const [downloading, setDownloading] = useState(false);
            const [copied, setCopied] = useState(false);
            
            const styles = getCategoryStyles(material.category);
            const isFile = material.isFile;
            const fullTitle = material.topic ? `${material.subject}: ${material.topic}` : material.subject;
            const displayTitle = material.topic || material.subject;
            const yearShort = material.year || 'N/A';
            
            const handleDownload = (e) => {
                e.stopPropagation();
                if (downloading) return;
                setDownloading(true);

                setTimeout(() => {
                    if (isFile && material.fileData) {
                        const link = document.createElement('a');
                        link.href = material.fileData;
                        link.download = material.fileName || 'download';
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
                    } else {
                        window.open(material.link, '_blank');
                    }
                    setDownloading(false);
                }, 800);
            };

            const handleShare = (e) => {
                e.stopPropagation();
                const url = isFile ? (material.fileData || '') : material.link;
                navigator.clipboard.writeText(url);
                setCopied(true);
                setTimeout(() => setCopied(false), 2000);
            };

            // Compact Card (Recent Uploads) - Glass Pill Style
            if (compact) {
                return (
                    <div className="group relative flex items-stretch bg-white/[0.03] hover:bg-white/[0.06] border border-white/5 hover:border-white/10 rounded-xl overflow-hidden transition-all duration-300 hover:-translate-y-1 hover:shadow-xl hover:shadow-cyan-500/5 backdrop-blur-sm h-20">
                        <div className="flex-1 p-3 flex flex-col justify-center min-w-0">
                            <div className="flex items-center gap-2 mb-1">
                                <span className={`text-[9px] font-bold uppercase tracking-wider text-transparent bg-clip-text bg-gradient-to-r from-white to-slate-400`}>
                                    {material.category}
                                </span>
                                <span className="text-[9px] text-slate-500">{new Date(material.createdAt || '').toLocaleDateString()}</span>
                            </div>
                            <h3 className="text-sm font-bold text-white truncate transition-colors tracking-tight" title={fullTitle}>
                                {displayTitle}
                            </h3>
                            <p className="text-[10px] text-slate-500 mt-0.5 truncate">{material.subject}</p>
                        </div>
                        
                        <button 
                            onClick={handleDownload}
                            className={`w-14 flex items-center justify-center border-l border-white/5 transition-all duration-300 ${downloading ? 'bg-emerald-500 text-white' : 'bg-white/[0.02] hover:bg-cyan-500 text-slate-400 hover:text-white'}`}
                        >
                            {downloading ? <Check className="w-5 h-5" /> : <Download className="w-5 h-5" />}
                        </button>
                    </div>
                );
            }

            // Standard Card - Cyber Glass Style
            return (
                <div className="group relative flex flex-col h-full">
                    {/* Glow Effect behind card */}
                    <div className={`absolute -inset-0.5 ${styles.btnGradient} rounded-[20px] opacity-0 group-hover:opacity-20 blur-xl transition duration-500`}></div>
                    
                    <div className="relative flex-1 flex flex-col bg-[#0e1218]/80 backdrop-blur-md border border-white/5 rounded-[18px] overflow-hidden transition-all duration-300 group-hover:border-white/10 group-hover:shadow-2xl group-hover:shadow-black/50">
                        
                        {/* Header Image/Pattern Area - Reduced Height */}
                        <div className="h-16 w-full relative overflow-hidden bg-white/[0.02] border-b border-white/5 flex items-center justify-center">
                            {/* Ambient Blob */}
                            <div className={`absolute top-0 right-0 w-24 h-24 ${styles.btnGradient} opacity-20 blur-2xl -mr-8 -mt-8 rounded-full group-hover:opacity-30 transition-opacity duration-500`}></div>
                            
                            {/* Centered Big Label */}
                            <div className="relative z-10 px-4 text-center">
                                <h2 className="text-lg font-black text-white/90 uppercase tracking-widest drop-shadow-lg scale-100 group-hover:scale-105 transition-transform duration-300">
                                    {material.category}
                                </h2>
                            </div>

                            {/* Subtle Emoji Watermark */}
                            <div className="absolute -bottom-3 -left-2 text-5xl opacity-5 filter blur-[1px] select-none pointer-events-none transform rotate-12">
                                {styles.emoji}
                            </div>

                            {/* Action Buttons (Absolute Positioned) */}
                            <div className="absolute top-1.5 right-1.5 flex gap-1">
                                <button 
                                    onClick={handleShare}
                                    className="w-6 h-6 flex items-center justify-center rounded-full bg-black/20 hover:bg-white/10 text-slate-400 hover:text-white transition-all backdrop-blur-sm border border-white/5"
                                    title="Copy Link"
                                >
                                    {copied ? <Check className="w-3 h-3 text-emerald-400" /> : <Share2 className="w-3 h-3" />}
                                </button>
                                <button 
                                    onClick={() => onToggleSave(material.id)}
                                    className={`w-6 h-6 flex items-center justify-center rounded-full backdrop-blur-sm border border-white/5 transition-all ${isSaved ? 'bg-rose-500/20 text-rose-400' : 'bg-black/20 text-slate-400 hover:bg-rose-500/20 hover:text-rose-400'}`}
                                >
                                    <Heart className={`w-3 h-3 ${isSaved ? 'fill-current' : ''}`} />
                                </button>
                            </div>
                        </div>

                        {/* Content Body - Reduced Padding */}
                        <div className="p-3 flex-1 flex flex-col">
                            <div className="mb-auto">
                                <h3 className="text-base font-extrabold text-white leading-tight mb-1 line-clamp-2 tracking-tight group-hover:text-cyan-400 transition-colors drop-shadow-sm" title={fullTitle}>
                                    {displayTitle}
                                </h3>
                                <p className="text-[10px] text-slate-500 line-clamp-1 font-medium">{material.subject}</p>
                            </div>

                            <div className="mt-2 pt-2 border-t border-white/5 flex items-center justify-between">
                                <div className="flex items-center gap-1.5 text-[10px] text-slate-400">
                                    <User className="w-3 h-3" />
                                    <span className="truncate max-w-[90px]">{material.teacher}</span>
                                </div>
                                <div className="text-[10px] font-mono text-slate-600">
                                    {yearShort}
                                </div>
                            </div>
                        </div>

                        {/* Action Button - Full Width Bottom */}
                        <button
                            onClick={handleDownload}
                            className={`w-full py-3 border-t border-white/5 transition-all flex items-center justify-center gap-2 text-[10px] font-bold uppercase tracking-wide ${downloading ? 'bg-emerald-500 text-white' : 'bg-white/[0.02] text-slate-400 hover:text-white hover:bg-cyan-600'}`}
                        >
                            {downloading ? (
                                <>Downloading...</>
                            ) : (
                                <>
                                    Download <Download className="w-3 h-3" />
                                </>
                            )}
                        </button>
                    </div>
                </div>
            );
        };

        // --- MODALS ---
        const ModalWrapper = ({ children, onClose }) => (
            <div className="fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black/80 backdrop-blur-md animate-fadeIn">
                <div className="absolute inset-0" onClick={onClose}></div>
                {children}
            </div>
        );

        const NotificationModal = ({ message, type, onClose }) => {
            const isError = type === 'error';
            const colorClass = isError ? 'text-rose-400 bg-rose-500/10 border-rose-500/20' : 'text-emerald-400 bg-emerald-500/10 border-emerald-500/20';
            
            return (
                <ModalWrapper onClose={onClose}>
                    <div className="relative z-10 bg-[#151a22] border border-white/10 rounded-2xl p-6 shadow-[0_20px_40px_rgba(0,0,0,0.6)] max-w-sm w-full text-center modal-enter">
                        <div className={`w-12 h-12 rounded-full mx-auto mb-4 flex items-center justify-center ${colorClass}`}>
                        {isError ? <AlertTriangle className="w-6 h-6"/> : <CheckCircle className="w-6 h-6"/>}
                        </div>
                        <h3 className="text-lg font-bold text-white mb-2">{isError ? 'Oops!' : 'Success'}</h3>
                        <p className="text-slate-400 text-sm mb-6">{message}</p>
                        <button onClick={onClose} className="w-full py-3 bg-white/5 hover:bg-white/10 text-white rounded-xl text-sm font-bold transition-colors border border-white/5">Okay</button>
                    </div>
                </ModalWrapper>
            );
        };

        const ConfirmationModal = ({ message, onConfirm, onClose }) => (
            <ModalWrapper onClose={onClose}>
                <div className="relative z-10 bg-[#151a22] border border-white/10 rounded-2xl p-6 shadow-[0_20px_40px_rgba(0,0,0,0.6)] max-w-sm w-full text-center modal-enter">
                    <div className="w-12 h-12 rounded-full mx-auto mb-4 flex items-center justify-center text-amber-400 bg-amber-500/10 border border-amber-500/20">
                        <HelpCircle className="w-6 h-6" />
                    </div>
                    <h3 className="text-lg font-bold text-white mb-2">Confirm Action</h3>
                    <p className="text-slate-400 text-sm mb-6">{message}</p>
                    <div className="flex gap-3">
                        <button onClick={onClose} className="flex-1 py-3 bg-white/5 hover:bg-white/10 text-slate-300 rounded-xl text-sm font-bold transition-colors border border-white/5">Cancel</button>
                        <button onClick={() => { onConfirm(); onClose(); }} className="flex-1 py-3 bg-gradient-to-r from-cyan-500 to-blue-600 hover:from-cyan-400 hover:to-blue-500 text-white rounded-xl text-sm font-bold transition-colors shadow-lg">Confirm</button>
                    </div>
                </div>
            </ModalWrapper>
        );

        const NoticeBoardModal = ({ notices, onClose }) => (
            <ModalWrapper onClose={onClose}>
                <div className="relative z-10 w-full max-w-2xl bg-[#151a22] border border-white/10 rounded-3xl shadow-[0_20px_40px_rgba(0,0,0,0.6)] overflow-hidden modal-enter flex flex-col max-h-[80vh]">
                    <div className="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-cyan-500 via-purple-500 to-emerald-500"></div>
                    <div className="flex justify-between items-center p-6 border-b border-white/10 bg-white/[0.02]">
                        <h2 className="text-xl font-bold text-white flex items-center gap-3">
                            <div className="h-8 w-8 rounded-full bg-cyan-500/10 flex items-center justify-center border border-cyan-500/20">
                                <Bell className="w-4 h-4 text-cyan-400" />
                            </div>
                            Latest Notices
                        </h2>
                        <button onClick={onClose} className="p-2 rounded-full hover:bg-white/10 text-slate-400 hover:text-white transition-all">
                            <X className="w-6 h-6" />
                        </button>
                    </div>
                    <div className="p-6 overflow-y-auto custom-scrollbar space-y-3 bg-[#0e1218]">
                        {notices.map(notice => (
                            <div key={notice.id} className="flex flex-col sm:flex-row sm:items-center justify-between bg-white/[0.03] border border-white/5 p-4 rounded-xl hover:bg-white/[0.05] transition-colors group">
                                <div className="flex-1 pr-4">
                                    <h3 className="text-sm font-bold text-slate-200 group-hover:text-cyan-200 transition-colors">{notice.title}</h3>
                                    <p className="text-xs text-slate-400 mt-1 leading-relaxed">{notice.message}</p>
                                </div>
                                <div className="flex items-center gap-2 mt-3 sm:mt-0 text-[10px] font-medium text-slate-500 bg-black/20 px-2.5 py-1.5 rounded-lg border border-white/5 shrink-0 whitespace-nowrap">
                                    <Calendar className="w-3 h-3" /> {new Date(notice.date).toLocaleDateString()}
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            </ModalWrapper>
        );

        const DriveFinderModal = ({ onClose, onSearch }) => {
            const [year, setYear] = useState(YEARS[0]);
            const [term, setTerm] = useState(DRIVE_TERMS[0]);

            return (
                <ModalWrapper onClose={onClose}>
                    <div className="relative z-10 w-full max-w-sm bg-[#151a22] border border-white/10 rounded-3xl shadow-[0_20px_40px_rgba(0,0,0,0.6)] overflow-hidden modal-enter">
                        <div className="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-purple-500 via-pink-500 to-purple-500"></div>
                        <button onClick={onClose} className="absolute top-4 right-4 text-slate-400 hover:text-white"><X className="w-6 h-6" /></button>
                        <div className="p-8 text-center">
                            <div className="w-16 h-16 bg-purple-500/10 rounded-full flex items-center justify-center mx-auto mb-6 border border-purple-500/20 shadow-[0_0_20px_rgba(168,85,247,0.15)]">
                                <Search className="w-8 h-8 text-purple-400" />
                            </div>
                            <h2 className="text-2xl font-bold text-white mb-2">Find Archives</h2>
                            <p className="text-sm text-slate-400 mb-8">Select session details below</p>
                            <div className="space-y-4 mb-8 text-left">
                                <div>
                                    <label className="text-[10px] font-bold text-slate-500 ml-1 mb-1 block">YEAR</label>
                                    <select value={year} onChange={(e) => setYear(e.target.value)} className="w-full bg-[#0d1016] border border-white/10 rounded-xl px-4 py-3 text-sm text-white outline-none focus:border-purple-500/50 transition-colors">
                                        {YEARS.map(y => <option key={y} value={y} className="bg-[#0d1016]">{y}</option>)}
                                    </select>
                                </div>
                                <div>
                                    <label className="text-[10px] font-bold text-slate-500 ml-1 mb-1 block">TERM</label>
                                    <select value={term} onChange={(e) => setTerm(e.target.value)} className="w-full bg-[#0d1016] border border-white/10 rounded-xl px-4 py-3 text-sm text-white outline-none focus:border-purple-500/50 transition-colors">
                                        {DRIVE_TERMS.map(t => <option key={t} value={t} className="bg-[#0d1016]">{t}</option>)}
                                    </select>
                                </div>
                            </div>
                            <button onClick={() => onSearch(year, term)} className="w-full py-4 bg-white text-black font-bold rounded-xl hover:bg-slate-200 transition-colors flex items-center justify-center gap-2 shadow-lg">
                                SHOW DRIVE <ArrowRight className="w-4 h-4" />
                            </button>
                        </div>
                    </div>
                </ModalWrapper>
            );
        };

        const DriveResultModal = ({ results, onClose }) => (
            <ModalWrapper onClose={onClose}>
                <div className="relative z-10 w-full max-w-md bg-[#151a22] border border-white/10 rounded-3xl shadow-[0_20px_40px_rgba(0,0,0,0.6)] overflow-hidden transform scale-100 transition-transform modal-enter">
                    <div className="flex justify-between items-center p-6 border-b border-white/10 bg-white/[0.02]">
                        <h2 className="text-lg font-bold text-white flex items-center gap-2"><FolderOpen className="w-5 h-5 text-purple-400" /> Results Found</h2>
                        <button onClick={onClose} className="p-2 rounded-full hover:bg-white/10 text-slate-400 hover:text-white transition-all"><X className="w-6 h-6" /></button>
                    </div>
                    <div className="p-6 max-h-[60vh] overflow-y-auto custom-scrollbar">
                        {results.length === 0 ? (
                            <div className="text-center py-10">
                                <div className="inline-block p-4 bg-rose-500/10 rounded-full mb-3 border border-rose-500/20"><AlertTriangle className="w-8 h-8 text-rose-400" /></div>
                                <p className="text-slate-300 font-medium mt-2">No archives found for this session.</p>
                                <button onClick={onClose} className="mt-4 text-xs text-purple-400 hover:text-purple-300 hover:underline">Try a different year</button>
                            </div>
                        ) : (
                            <div className="space-y-4">
                                {results.map(l => (
                                    <div key={l.id} className="bg-[#0d1016] border border-white/5 rounded-2xl p-6 hover:border-purple-500/30 transition-all group shadow-lg relative overflow-hidden">
                                        <div className="absolute top-0 right-0 w-32 h-32 bg-purple-500/5 rounded-full blur-3xl -mr-16 -mt-16 pointer-events-none"></div>
                                        <div className="flex justify-between items-start mb-4 relative z-10">
                                            <span className="text-[10px] font-bold text-purple-300 bg-purple-500/10 px-2 py-1 rounded border border-purple-500/20 tracking-wider">BATCH</span>
                                            <div className="text-right">
                                                <div className="text-xs font-bold text-white">{l.year}</div>
                                                <div className="text-[10px] text-slate-400 uppercase">{l.term}</div>
                                            </div>
                                        </div>
                                        <h3 className="text-xl font-bold text-white mb-6 tracking-tight relative z-10">{l.batch}</h3>
                                        <a href={l.link} target="_blank" rel="noreferrer" className="relative z-10 flex items-center justify-center gap-3 w-full py-3.5 rounded-xl bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-500 hover:to-pink-500 text-white font-bold text-sm transition-all shadow-lg group-hover:scale-[1.02]">
                                            <ExternalLink className="w-4 h-4" /> OPEN GOOGLE DRIVE
                                        </a>
                                    </div>
                                ))}
                            </div>
                        )}
                    </div>
                </div>
            </ModalWrapper>
        );

        const SignatureModal = ({ onClose }) => (
            <ModalWrapper onClose={onClose}>
                <div className="relative z-10 w-full max-w-6xl h-[90vh] bg-[#151a22] border border-white/10 rounded-3xl shadow-[0_20px_40px_rgba(0,0,0,0.6)] overflow-hidden flex flex-col modal-enter">
                    <div className="flex justify-between items-center p-4 border-b border-white/10 bg-white/[0.02]">
                        <h2 className="text-lg font-bold text-white flex items-center gap-3">
                            <div className="p-2 bg-cyan-500/10 rounded-lg border border-cyan-500/20">
                                <PenTool className="w-5 h-5 text-cyan-400" />
                            </div>
                            Gmail Signature Creator
                        </h2>
                        <button onClick={onClose} className="p-2 rounded-full hover:bg-white/10 text-slate-400 hover:text-white transition-all">
                            <X className="w-6 h-6" />
                        </button>
                    </div>
                    <div className="flex-1 bg-white relative">
                        <iframe src="https://sawon76.github.io/gmail-signature/" className="w-full h-full border-0" title="Gmail Signature Creator"></iframe>
                    </div>
                </div>
            </ModalWrapper>
        );

        const BookSearchModal = ({ onClose }) => {
            const [query, setQuery] = useState('');
            const [books, setBooks] = useState([]);
            const [loading, setLoading] = useState(false);
            const [searched, setSearched] = useState(false);

            const handleSearch = async (e) => {
                e.preventDefault();
                if (!query.trim()) return;
                setLoading(true);
                setSearched(true);
                
                // 1. Create One Combined External Card
                const externalCard = {
                    id: 'ext-combined',
                    title: 'External Databases',
                    isCombined: true,
                    links: [
                        { 
                            name: 'Z-Library', 
                            url: `https://z-lib.gd/s/${encodeURIComponent(query)}`,
                            color: 'blue',
                            icon: <Globe className="w-3 h-3" />
                        },
                        { 
                            name: 'LibGen', 
                            url: `https://libgen.li/index.php?req=${encodeURIComponent(query)}`,
                            color: 'emerald',
                            icon: <Database className="w-3 h-3" />
                        },
                        { 
                            name: 'Liber3', 
                            url: `https://liber3.eth.limo/#/search?q=${encodeURIComponent(query)}`,
                            color: 'purple',
                            icon: <Server className="w-3 h-3" />
                        }
                    ]
                };

                // 2. Fetch Google Books
                const googleResults = await bookService.searchBooks(query);
                
                // 3. Combine Results (External Card First)
                setBooks([externalCard, ...googleResults]);
                setLoading(false);
            };

            return (
                <ModalWrapper onClose={onClose}>
                    <div className="relative z-10 w-full max-w-6xl h-[85vh] bg-[#151a22] border border-white/10 rounded-3xl shadow-[0_20px_40px_rgba(0,0,0,0.6)] overflow-hidden flex flex-col modal-enter">
                        <div className="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-blue-500 via-indigo-500 to-blue-500"></div>
                        
                        {/* Fixed Header */}
                        <div className="flex justify-between items-center p-6 border-b border-white/10 bg-white/[0.02]">
                            <h2 className="text-xl font-bold text-white flex items-center gap-3">
                                <div className="w-10 h-10 bg-blue-500/10 rounded-full flex items-center justify-center border border-blue-500/20">
                                    <Book className="w-5 h-5 text-blue-400" />
                                </div>
                                Library Search
                            </h2>
                            <button onClick={onClose} className="p-2 rounded-full hover:bg-white/10 text-slate-400 hover:text-white transition-all">
                                <X className="w-6 h-6" />
                            </button>
                        </div>

                        {/* Scrollable Content (Search Box is now inside here) */}
                        <div className="flex-1 overflow-y-auto p-6 custom-scrollbar bg-[#0d1016]">
                            
                            {/* Search Box - Scrolls away */}
                            <div className="max-w-2xl mx-auto mb-8">
                                <form onSubmit={handleSearch} className="relative">
                                    <input 
                                        type="text" 
                                        value={query} 
                                        onChange={(e) => setQuery(e.target.value)} 
                                        className="w-full bg-[#1c2128] border border-white/10 text-white pl-12 pr-28 py-4 rounded-2xl outline-none focus:border-blue-500/50 focus:bg-[#1c2128]/80 transition-all shadow-lg placeholder-slate-500" 
                                        placeholder="Search by book title, author, or ISBN..."
                                        autoFocus
                                    />
                                    <Search className="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-500" />
                                    <button type="submit" disabled={loading} className="absolute right-2 top-2 bottom-2 px-6 bg-blue-600 hover:bg-blue-500 text-white rounded-xl font-bold text-sm transition-colors flex items-center gap-2">
                                        {loading ? <Loader2 className="w-4 h-4 animate-spin" /> : <>Search <ArrowRight className="w-4 h-4" /></>}
                                    </button>
                                </form>
                            </div>

                            {/* Results Grid */}
                            {!searched ? (
                                <div className="h-64 flex flex-col items-center justify-center text-slate-500 opacity-60">
                                    <BookOpen className="w-16 h-16 mb-4 text-slate-700" />
                                    <p className="text-sm font-medium text-slate-400">Enter a keyword to search the global library.</p>
                                    <p className="text-xs mt-2">Includes Google Books, Z-Library, LibGen & Liber3</p>
                                </div>
                            ) : books.length === 0 ? (
                                <div className="h-64 flex flex-col items-center justify-center text-slate-500">
                                    <AlertTriangle className="w-12 h-12 mb-4 text-slate-600" />
                                    <p>No books found matching "{query}"</p>
                                </div>
                            ) : (
                                <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-5">
                                    {books.map(book => (
                                        book.isCombined ? (
                                            /* Combined External Card */
                                            <div key={book.id} className="group relative flex flex-col h-full bg-[#0e1218]/80 backdrop-blur-md border border-white/5 rounded-[18px] overflow-hidden transition-all duration-300 hover:border-white/10 hover:shadow-2xl hover:shadow-black/50">
                                                <div className="h-40 w-full relative overflow-hidden bg-gradient-to-br from-blue-900/20 via-purple-900/20 to-emerald-900/20 flex items-center justify-center border-b border-white/5">
                                                     <div className="flex justify-center -space-x-4 relative z-20 pt-2">
                                                        <div className="w-12 h-12 rounded-full bg-[#151a22] border-2 border-blue-500/30 flex items-center justify-center shadow-lg transform -rotate-12 group-hover:-rotate-6 transition-transform duration-500"><Globe className="w-6 h-6 text-blue-400"/></div>
                                                        <div className="w-12 h-12 rounded-full bg-[#151a22] border-2 border-emerald-500/30 flex items-center justify-center shadow-lg z-10 group-hover:scale-110 transition-transform duration-500"><Database className="w-6 h-6 text-emerald-400"/></div>
                                                        <div className="w-12 h-12 rounded-full bg-[#151a22] border-2 border-purple-500/30 flex items-center justify-center shadow-lg transform rotate-12 group-hover:rotate-6 transition-transform duration-500"><Server className="w-6 h-6 text-purple-400"/></div>
                                                    </div>
                                                </div>
                                                
                                                <div className="p-5 flex-1 flex flex-col">
                                                    <h3 className="text-base font-extrabold text-white text-center mb-1">External Archives</h3>
                                                    <p className="text-[10px] text-slate-500 text-center mb-5">Direct search across multiple shadow libraries</p>
                                                    
                                                    <div className="space-y-2 mt-auto">
                                                        {book.links.map(link => (
                                                            <a 
                                                                key={link.name}
                                                                href={link.url} 
                                                                target="_blank" 
                                                                rel="noreferrer"
                                                                className={`flex items-center justify-between w-full py-2.5 px-4 rounded-xl text-[10px] font-bold border transition-all 
                                                                    ${link.color === 'blue' ? 'bg-blue-500/5 text-blue-400 border-blue-500/20 hover:bg-blue-500/10' : ''}
                                                                    ${link.color === 'emerald' ? 'bg-emerald-500/5 text-emerald-400 border-emerald-500/20 hover:bg-emerald-500/10' : ''}
                                                                    ${link.color === 'purple' ? 'bg-purple-500/5 text-purple-400 border-purple-500/20 hover:bg-purple-500/10' : ''}
                                                                `}
                                                            >
                                                                <span className="flex items-center gap-2">{link.icon} {link.name}</span>
                                                                <ExternalLink className="w-3 h-3 opacity-50"/>
                                                            </a>
                                                        ))}
                                                    </div>
                                                </div>
                                            </div>
                                        ) : (
                                            /* Normal Book Card */
                                            <div 
                                                key={book.id} 
                                                className="group relative flex flex-col h-full bg-[#0e1218]/80 backdrop-blur-md border border-white/5 rounded-[18px] overflow-hidden transition-all duration-300 hover:border-white/10 hover:shadow-2xl hover:shadow-black/50"
                                            >
                                                {/* Image Container */}
                                                <div className="h-48 w-full relative overflow-hidden bg-[#050505] flex items-center justify-center p-6 border-b border-white/5">
                                                    <div className="absolute inset-0 bg-gradient-to-b from-transparent to-[#0e1218]/80 z-10"></div>
                                                    {/* Glow behind image */}
                                                    <div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-24 h-32 bg-blue-500/20 blur-2xl rounded-full group-hover:bg-blue-500/30 transition-all duration-500 opacity-0 group-hover:opacity-100"></div>
                                                    
                                                    {book.thumbnail ? (
                                                        <img src={book.thumbnail} alt={book.title} className="relative z-20 h-full w-auto object-contain rounded shadow-[0_10px_20px_rgba(0,0,0,0.5)] group-hover:scale-105 transition-transform duration-300" />
                                                    ) : (
                                                        <div className="relative z-20 flex flex-col items-center justify-center text-slate-600">
                                                            <Book className="w-8 h-8 mb-2 opacity-50" />
                                                            <span className="text-[9px] font-bold">No Cover</span>
                                                        </div>
                                                    )}
                                                    
                                                    {/* Year Badge */}
                                                    <div className="absolute top-3 right-3 z-30">
                                                         <span className="text-[9px] font-bold bg-black/60 backdrop-blur border border-white/10 text-slate-300 px-2 py-1 rounded-lg">
                                                            {book.year}
                                                         </span>
                                                    </div>
                                                </div>

                                                {/* Content */}
                                                <div className="p-4 flex-1 flex flex-col">
                                                    <div className="mb-auto">
                                                        <h3 className="text-sm font-extrabold text-white leading-tight mb-2 line-clamp-2 group-hover:text-blue-400 transition-colors" title={book.title}>
                                                            {book.title}
                                                        </h3>
                                                        <div className="flex items-center gap-1.5 text-[10px] text-slate-500 font-medium">
                                                            <User className="w-3 h-3" />
                                                            <span className="truncate">{book.authors.join(', ')}</span>
                                                        </div>
                                                    </div>
                                                </div>

                                                {/* Action */}
                                                <a 
                                                    href={book.link} 
                                                    target="_blank" 
                                                    rel="noreferrer"
                                                    className="w-full py-3.5 border-t border-white/5 transition-all flex items-center justify-center gap-2 text-[10px] font-bold uppercase tracking-wide bg-white/[0.02] text-slate-400 hover:text-white hover:bg-blue-600/20 group-hover:border-white/10"
                                                >
                                                    Preview <Eye className="w-3 h-3" />
                                                </a>
                                            </div>
                                        )
                                    ))}
                                </div>
                            )}
                        </div>
                    </div>
                </ModalWrapper>
            );
        };

        const CRListModal = ({ onClose }) => {
            const groupedCRs = useMemo(() => {
                const groups = {};
                CR_DATA.forEach(cr => {
                    if (!groups[cr.year]) groups[cr.year] = [];
                    groups[cr.year].push(cr);
                });
                return groups;
            }, []);

            return (
                <ModalWrapper onClose={onClose}>
                    <div className="relative z-10 w-full max-w-4xl h-[85vh] bg-[#151a22] border border-emerald-500/30 rounded-3xl shadow-[0_20px_40px_rgba(0,0,0,0.6)] overflow-hidden flex flex-col modal-enter">
                        <div className="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-emerald-500 via-teal-500 to-emerald-500"></div>
                        
                        <div className="flex justify-between items-center p-6 border-b border-white/10 bg-white/[0.02]">
                            <h2 className="text-xl font-bold text-white flex items-center gap-3">
                                <div className="w-10 h-10 bg-emerald-500/10 rounded-full flex items-center justify-center border border-emerald-500/20">
                                    <Users className="w-5 h-5 text-emerald-400" />
                                </div>
                                Class Representatives
                            </h2>
                            <button onClick={onClose} className="p-2 rounded-full hover:bg-white/10 text-slate-400 hover:text-white transition-all">
                                <X className="w-6 h-6" />
                            </button>
                        </div>

                        <div className="flex-1 overflow-y-auto p-6 custom-scrollbar">
                             {Object.keys(groupedCRs).sort().reverse().map((year) => (
                                <div key={year} className="mb-8 last:mb-0">
                                    <div className="flex items-center gap-3 mb-4">
                                        <h3 className="text-lg font-bold text-emerald-400">{year}</h3>
                                        <div className="h-px flex-1 bg-gradient-to-r from-emerald-500/20 to-transparent"></div>
                                    </div>
                                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-4">
                                        {groupedCRs[year].map((cr) => (
                                            <div key={cr.id} className="group flex items-center justify-between p-4 bg-[#0d1016] border border-white/5 rounded-xl hover:border-emerald-500/30 transition-all hover:bg-white/[0.02]">
                                                <div className="flex items-center gap-4">
                                                    <div className="w-10 h-10 rounded-full bg-emerald-500/10 flex items-center justify-center border border-emerald-500/20 text-emerald-400 font-bold text-sm">
                                                        {cr.section}
                                                    </div>
                                                    <div>
                                                        <h4 className="text-sm font-bold text-white group-hover:text-emerald-300 transition-colors">{cr.name}</h4>
                                                        <div className="text-xs text-slate-500 mt-0.5">Section {cr.section}</div>
                                                    </div>
                                                </div>
                                                <a href={`tel:${cr.phone}`} className="flex items-center gap-2 px-3 py-2 rounded-lg bg-white/5 hover:bg-emerald-500/20 text-slate-400 hover:text-emerald-400 transition-all border border-white/5 hover:border-emerald-500/20">
                                                    <Phone className="w-3.5 h-3.5" />
                                                    <span className="text-xs font-mono font-medium hidden sm:inline">{cr.phone}</span>
                                                </a>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                             ))}
                        </div>
                    </div>
                </ModalWrapper>
            );
        };

        // --- VIEWS ---

        const Login = ({ onLogin, notify }) => {
            const [token, setToken] = useState('');
            const [loading, setLoading] = useState(false);

            const handleSubmit = async (e) => {
                e.preventDefault();
                const trimmed = token.trim();
                if (!trimmed.startsWith('ghp_') && !trimmed.startsWith('github_pat_')) {
                    notify("Invalid Token format. Must start with ghp_ or github_pat_", 'error');
                    return;
                }

                setLoading(true);
                try {
                    const user = await githubService.getUser(trimmed);
                    onLogin(user, trimmed);
                } catch (error) {
                    notify("Token verification failed. Check permissions.", 'error');
                }
                setLoading(false);
            };

            return (
                <div className="flex justify-center items-center py-20 animate-fadeIn">
                    <div className="w-full max-w-md bg-[#151a22] border border-white/5 p-8 rounded-[18px] shadow-[0_20px_40px_rgba(0,0,0,0.6)]">
                        <div className="text-center mb-8">
                            <div className="inline-block p-4 bg-cyan-500/10 rounded-full border border-cyan-500/20 mb-4">
                                <Key className="w-8 h-8 text-cyan-400" />
                            </div>
                            <h2 className="text-2xl font-bold text-white">Admin Authentication</h2>
                        </div>
                        <form onSubmit={handleSubmit} className="space-y-6">
                            <div>
                                <label className="block text-xs font-bold text-slate-300 mb-2 ml-1">GITHUB TOKEN</label>
                                <input 
                                    type="password" 
                                    value={token}
                                    onChange={(e) => setToken(e.target.value)}
                                    className="w-full bg-[#0d1016] border border-white/10 text-white p-4 rounded-xl outline-none focus:border-cyan-500/50 transition-colors" 
                                    required 
                                />
                            </div>
                            <button 
                                type="submit" 
                                disabled={loading}
                                className="w-full py-3 rounded-xl text-sm font-bold text-white bg-gradient-to-r from-cyan-500 to-blue-600 hover:brightness-110 transition-all disabled:opacity-50"
                            >
                                {loading ? 'VERIFYING...' : 'VERIFY'}
                            </button>
                        </form>
                    </div>
                </div>
            );
        };

        const Home = ({ materials, notices, loading }) => {
            const [filterYear, setFilterYear] = useState('All');
            const [filterSem, setFilterSem] = useState('All');
            const [filterSubject, setFilterSubject] = useState('All');
            const [filterCategory, setFilterCategory] = useState('All');
            const [searchSub, setSearchSub] = useState('');
            const [showSavedOnly, setShowSavedOnly] = useState(false);
            const [savedIds, setSavedIds] = useState(new Set());
            
            // Scroll and Modal State
            const [isScrolled, setIsScrolled] = useState(false);
            const [showFilterModal, setShowFilterModal] = useState(false);
            const [showNoticeModal, setShowNoticeModal] = useState(false);

            useEffect(() => {
                const saved = localStorage.getItem('saved_materials');
                if (saved) setSavedIds(new Set(JSON.parse(saved)));

                const handleScroll = () => {
                    setIsScrolled(window.scrollY > 150);
                };
                window.addEventListener('scroll', handleScroll);
                return () => window.removeEventListener('scroll', handleScroll);
            }, []);

            const toggleSave = (id) => {
                const newSaved = new Set(savedIds);
                if (newSaved.has(id)) newSaved.delete(id);
                else newSaved.add(id);
                setSavedIds(newSaved);
                localStorage.setItem('saved_materials', JSON.stringify(Array.from(newSaved)));
            };

            const filteredMaterials = useMemo(() => {
                return materials.filter(m => {
                    const y = filterYear === 'All' || m.year === filterYear;
                    const s = filterSem === 'All' || m.semester === filterSem;
                    const saved = !showSavedOnly || savedIds.has(m.id);
                    return y && s && saved;
                });
            }, [materials, filterYear, filterSem, showSavedOnly, savedIds]);

            const availableSubjects = useMemo(() => {
                return [...new Set(filteredMaterials.map(m => m.subject || ''))].filter(Boolean).sort();
            }, [filteredMaterials]);

            const finalFiltered = useMemo(() => {
                return filteredMaterials.filter(m => {
                    const subMatch = filterSubject === 'All' || m.subject === filterSubject;
                    const catMatch = filterCategory === 'All' || m.category === filterCategory;
                    const q = searchSub.toLowerCase();
                    const searchMatch = !q || 
                        (m.subject && m.subject.toLowerCase().includes(q)) || 
                        (m.topic && m.topic.toLowerCase().includes(q)) || 
                        (m.teacher && m.teacher.toLowerCase().includes(q));
                    return subMatch && catMatch && searchMatch;
                });
            }, [filteredMaterials, filterSubject, filterCategory, searchSub]);

            const recentMaterials = useMemo(() => {
                const now = new Date();
                const twoDaysAgo = new Date(now.getTime() - (48 * 60 * 60 * 1000));
                return [...materials]
                    .filter(m => m.createdAt && new Date(m.createdAt) > twoDaysAgo)
                    .sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime());
            }, [materials]);

            const groupedMaterials = useMemo(() => {
                return finalFiltered.reduce((acc, item) => {
                    const subj = item.subject || 'Uncategorized';
                    if (!acc[subj]) acc[subj] = [];
                    acc[subj].push(item);
                    return acc;
                }, {});
            }, [finalFiltered]);

            const sortedSubjects = Object.keys(groupedMaterials).sort();

            if (filterSubject !== 'All' && !availableSubjects.includes(filterSubject)) {
                setFilterSubject('All');
            }

            const SelectWrapper = ({ value, onChange, options, icon: Icon, label }) => (
                <div className="relative group">
                    <div className="absolute inset-y-0 left-3 flex items-center pointer-events-none z-10">
                        <Icon className="w-3.5 h-3.5 text-slate-500 group-hover:text-cyan-400 transition-colors" />
                    </div>
                    <select 
                        value={value} 
                        onChange={onChange} 
                        className="appearance-none w-full bg-[#0a0d12] border border-white/10 text-slate-300 h-10 pl-9 pr-8 rounded-lg text-xs font-medium outline-none cursor-pointer focus:border-cyan-500/50 hover:bg-white/5 transition-all shadow-sm"
                    >
                        <option value="All" className="bg-[#0a0d12] text-slate-300">{label}</option>
                        {options.map(o => <option key={o} value={o} className="bg-[#0a0d12] text-slate-300">{o}</option>)}
                    </select>
                    <ChevronDown className="absolute right-3 top-1/2 -translate-y-1/2 w-3.5 h-3.5 text-slate-600 pointer-events-none group-hover:text-slate-400" />
                </div>
            );

            const renderControlCenterContent = (isModal = false) => (
                <>
                    <div className="flex items-center justify-between mb-4 px-1">
                         <div className="flex items-center gap-2 text-xs font-bold text-slate-400 uppercase tracking-widest">
                            <Filter className="w-3.5 h-3.5 text-cyan-500" /> {isModal ? 'Filter Resources' : 'Control Center'}
                        </div>
                        <div className="text-[10px] text-slate-600 font-mono">
                            {finalFiltered.length} Results
                        </div>
                    </div>
                    
                    <div className={`grid grid-cols-2 ${isModal ? 'gap-4' : 'md:grid-cols-4 lg:grid-cols-6 gap-3'}`}>
                        <SelectWrapper value={filterYear} onChange={(e) => setFilterYear(e.target.value)} options={YEARS} icon={Calendar} label="All Years" />
                        <SelectWrapper value={filterSem} onChange={(e) => setFilterSem(e.target.value)} options={SEMESTERS} icon={BookOpen} label="All Sems" />
                        
                        <div className={isModal ? 'col-span-2' : 'col-span-2 lg:col-span-1'}>
                             <div className="relative group">
                                <div className="absolute inset-y-0 left-3 flex items-center pointer-events-none z-10">
                                    <BookOpen className="w-3.5 h-3.5 text-slate-500 group-hover:text-cyan-400 transition-colors" />
                                </div>
                                <select 
                                    value={filterSubject} 
                                    onChange={e => setFilterSubject(e.target.value)} 
                                    disabled={availableSubjects.length === 0}
                                    className="appearance-none w-full bg-[#0a0d12] border border-white/10 text-slate-300 h-10 pl-9 pr-8 rounded-lg text-xs font-medium outline-none cursor-pointer focus:border-cyan-500/50 hover:bg-white/5 transition-all shadow-sm disabled:opacity-50"
                                >
                                    <option value="All" className="bg-[#0a0d12] text-slate-300">All Subjects</option>
                                    {availableSubjects.map(sub => <option key={sub} value={sub} className="bg-[#0a0d12] text-slate-300">{sub}</option>)}
                                </select>
                                <ChevronDown className="absolute right-3 top-1/2 -translate-y-1/2 w-3.5 h-3.5 text-slate-600 pointer-events-none" />
                            </div>
                        </div>
                        
                        <div className={`relative group ${isModal ? 'col-span-2' : ''}`}>
                            <select value={filterCategory} onChange={e => setFilterCategory(e.target.value)} className="appearance-none w-full bg-[#0a0d12] border border-white/10 text-slate-300 h-10 px-4 rounded-lg text-xs font-medium outline-none cursor-pointer focus:border-cyan-500/50 hover:bg-white/5 transition-all shadow-sm">
                                <option value="All" className="bg-[#0a0d12] text-slate-300">Categories</option>
                                {CATEGORIES.map(c => <option key={c} value={c} className="bg-[#0a0d12] text-slate-300">{c}</option>)}
                            </select>
                             <ChevronDown className="absolute right-3 top-1/2 -translate-y-1/2 w-3.5 h-3.5 text-slate-600 pointer-events-none" />
                        </div>

                        <button 
                            onClick={() => setShowSavedOnly(!showSavedOnly)}
                            className={`h-10 px-4 rounded-lg flex items-center justify-center gap-2 text-xs font-bold border transition-all shadow-sm ${showSavedOnly ? 'bg-rose-500/10 border-rose-500/30 text-rose-400' : 'bg-[#0a0d12] border-white/10 text-slate-400 hover:text-white hover:bg-white/5'}`}
                        >
                            <Heart className={`w-3.5 h-3.5 ${showSavedOnly ? 'fill-current' : ''}`} />
                            Saved
                        </button>

                        <div className={`relative ${isModal ? 'col-span-2' : 'col-span-2 lg:col-span-1'}`}>
                            <input value={searchSub} onChange={e => setSearchSub(e.target.value)} className="w-full bg-[#0a0d12] border border-white/10 text-slate-200 h-10 pl-9 pr-4 rounded-lg text-xs outline-none placeholder-slate-600 focus:border-cyan-500/50 hover:bg-white/5 transition-all shadow-sm" placeholder="Search topics..." />
                            <Search className="absolute left-3 top-1/2 -translate-y-1/2 w-3.5 h-3.5 text-slate-500 pointer-events-none" />
                        </div>
                    </div>
                </>
            );

            const NoticeBoard = () => {
                if (loading) return <NoticeSkeleton />;
                if (notices.length === 0) return null;

                return (
                    <div className="mb-10 p-[1px] bg-gradient-to-r from-cyan-500/20 via-purple-500/20 to-emerald-500/20 rounded-[24px] animate-fadeIn">
                        <div className="bg-[#0e1218]/90 backdrop-blur-xl rounded-[23px] p-6 relative overflow-hidden">
                            <div className="absolute top-0 right-0 w-64 h-64 bg-cyan-500/10 rounded-full blur-[100px] -mr-20 -mt-20 pointer-events-none"></div>
                            
                            <div className="flex items-center gap-3 mb-5 relative z-10">
                                <div className="h-8 w-8 rounded-full bg-cyan-500/10 flex items-center justify-center border border-cyan-500/20">
                                    <Bell className="w-4 h-4 text-cyan-400" />
                                </div>
                                <h2 className="text-lg font-bold text-white tracking-tight">Latest Notices</h2>
                            </div>
                            
                            <div className="grid gap-3 relative z-10">
                                {notices.map(notice => (
                                    <div key={notice.id} className="flex flex-col sm:flex-row sm:items-center justify-between bg-white/[0.03] border border-white/5 p-4 rounded-xl hover:bg-white/[0.05] transition-colors group">
                                        <div className="flex-1 pr-4">
                                            <h3 className="text-sm font-bold text-slate-200 group-hover:text-cyan-200 transition-colors">{notice.title}</h3>
                                            <p className="text-xs text-slate-400 mt-1 leading-relaxed">{notice.message}</p>
                                        </div>
                                        <div className="flex items-center gap-2 mt-3 sm:mt-0 text-[10px] font-medium text-slate-500 bg-black/20 px-2.5 py-1.5 rounded-lg border border-white/5 shrink-0 whitespace-nowrap">
                                            <Calendar className="w-3 h-3" /> {new Date(notice.date).toLocaleDateString()}
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>
                );
            };

            return (
                <div className="space-y-10 animate-fadeIn pb-24">
                    
                    <NoticeBoard />

                    {/* Control Center - Now Relative (Scrolls naturally) */}
                    <div className="relative z-30">
                         <div className="bg-[#0e1218]/70 backdrop-blur-xl rounded-[20px] shadow-2xl border border-white/10 p-4 md:p-5">
                            {renderControlCenterContent(false)}
                         </div>
                    </div>

                    {/* Floating Filter Button (Appears on scroll) */}
                    <div className={`fixed bottom-24 right-8 z-40 transition-all duration-300 ${isScrolled ? 'translate-y-0 opacity-100' : 'translate-y-10 opacity-0 pointer-events-none'}`}>
                        <button 
                            onClick={() => setShowFilterModal(true)}
                            className="w-14 h-14 bg-[#151a22] hover:bg-[#1c2128] border border-white/10 rounded-full shadow-2xl flex items-center justify-center text-cyan-400 hover:text-white hover:scale-105 transition-all group backdrop-blur-xl"
                        >
                            <Filter className="w-6 h-6 group-hover:rotate-12 transition-transform" />
                        </button>
                    </div>

                    {/* Floating Notice Button (Left Side) */}
                    {notices.length > 0 && (
                        <div className={`fixed bottom-24 left-8 z-40 transition-all duration-500 ${isScrolled ? 'translate-y-0 opacity-100' : 'translate-y-10 opacity-0 pointer-events-none'}`}>
                            <button 
                                onClick={() => setShowNoticeModal(true)}
                                className="w-12 h-12 bg-[#151a22] hover:bg-[#1c2128] border border-white/10 rounded-full shadow-2xl flex items-center justify-center text-cyan-400 hover:text-white hover:scale-105 transition-all group backdrop-blur-xl"
                            >
                                <Bell className="w-5 h-5 group-hover:rotate-12 transition-transform" />
                                <span className="absolute -top-1 -right-1 w-3 h-3 bg-rose-500 rounded-full border border-[#151a22]"></span>
                            </button>
                        </div>
                    )}

                    {/* Filter Modal */}
                    {showFilterModal && (
                        <div className="fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black/60 backdrop-blur-md animate-fadeIn">
                            <div className="absolute inset-0" onClick={() => setShowFilterModal(false)}></div>
                            <div className="relative z-10 w-full max-w-lg bg-[#151a22] border border-white/10 rounded-3xl shadow-[0_20px_50px_rgba(0,0,0,0.8)] overflow-hidden modal-enter p-6">
                                <div className="flex justify-between items-center mb-6">
                                    <h3 className="text-lg font-bold text-white">Refine Search</h3>
                                    <button onClick={() => setShowFilterModal(false)} className="p-2 rounded-full hover:bg-white/10 text-slate-400 hover:text-white"><X className="w-6 h-6" /></button>
                                </div>
                                {renderControlCenterContent(true)}
                                <button 
                                    onClick={() => setShowFilterModal(false)} 
                                    className="w-full mt-6 py-4 bg-cyan-500 hover:bg-cyan-400 text-black font-bold rounded-xl transition-colors shadow-lg"
                                >
                                    View {finalFiltered.length} Resources
                                </button>
                            </div>
                        </div>
                    )}

                    {/* Notice Modal */}
                    {showNoticeModal && <NoticeBoardModal notices={notices} onClose={() => setShowNoticeModal(false)} />}

                    {loading ? (
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            {[1, 2, 3, 4, 5, 6].map(i => <CardSkeleton key={i} />)}
                        </div>
                    ) : (
                        <>
                            {recentMaterials.length > 0 && filterSubject === 'All' && searchSub === '' && !showSavedOnly && (
                                <div className="animate-fadeIn">
                                     <div className="flex items-center gap-2 mb-4 px-1">
                                        <Zap className="w-4 h-4 text-amber-400 fill-current" />
                                        <h2 className="text-sm font-bold text-slate-300 uppercase tracking-wider">Just Arrived</h2>
                                    </div>
                                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                                        {recentMaterials.map(m => (
                                            <MaterialCard key={m.id} material={m} compact isSaved={savedIds.has(m.id)} onToggleSave={toggleSave} />
                                        ))}
                                    </div>
                                    <div className="h-px w-full bg-gradient-to-r from-transparent via-white/10 to-transparent my-8"></div>
                                </div>
                            )}

                            {finalFiltered.length === 0 ? (
                                <div className="text-center py-24 flex flex-col items-center justify-center opacity-0 animate-fadeIn" style={{animationFillMode: 'forwards'}}>
                                    <div className="w-24 h-24 bg-gradient-to-tr from-white/5 to-transparent rounded-full flex items-center justify-center mb-6 border border-white/5 shadow-2xl">
                                        <Search className="w-10 h-10 text-slate-600" />
                                    </div>
                                    <h3 className="text-xl font-bold text-white mb-2">No materials found</h3>
                                    <p className="text-slate-500 max-w-xs mx-auto text-sm leading-relaxed">We couldn't find matches for your current filters. Try resetting them.</p>
                                    {(showSavedOnly || filterSubject !== 'All') && (
                                        <button onClick={() => {setShowSavedOnly(false); setFilterSubject('All'); setFilterCategory('All');}} className="mt-6 px-6 py-2 rounded-full bg-cyan-500/10 text-cyan-400 text-xs font-bold hover:bg-cyan-500/20 transition-all border border-cyan-500/20">
                                            Clear Filters
                                        </button>
                                    )}
                                </div>
                            ) : (
                                <div className="space-y-16">
                                    {sortedSubjects.map(subject => (
                                        <div key={subject} className="animate-fadeIn">
                                            <div className="flex items-end gap-4 mb-6 px-1">
                                                <h2 className="text-3xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-white to-slate-500 tracking-tight">{subject}</h2>
                                                <div className="h-px flex-1 bg-gradient-to-r from-white/10 to-transparent mb-2"></div>
                                                <span className="text-[10px] font-bold text-slate-500 bg-white/5 px-2 py-1 rounded-md border border-white/5 mb-1.5">
                                                    {groupedMaterials[subject].length}
                                                </span>
                                            </div>
                                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                                {groupedMaterials[subject].map(m => (
                                                    <MaterialCard 
                                                        key={m.id} 
                                                        material={m} 
                                                        isSaved={savedIds.has(m.id)} 
                                                        onToggleSave={toggleSave}
                                                    />
                                                ))}
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            )}
                        </>
                    )}
                </div>
            );
        };

        const Admin = ({ materials, driveLinks, notices, onSaveMaterial, onDeleteMaterial, onSaveDrive, onDeleteDrive, onSaveNotice, onDeleteNotice }) => {
            const [viewMode, setViewMode] = useState('materials');
            const [adminSearch, setAdminSearch] = useState('');
            const [currentPage, setCurrentPage] = useState(1);
            const ITEMS_PER_PAGE = 10;
            
            // Material Form State
            const [mForm, setMForm] = useState({
                id: null,
                year: YEARS[0], semester: SEMESTERS[0], subject: '', topic: '', teacher: '',
                category: 'Study Material', link: '', storageType: 'link',
                fileData: null, fileName: '', status: 'IDLE',
                locked: { year: false, semester: false, teacher: false, subject: false, category: false }
            });

            // Drive Form State
            const [dForm, setDForm] = useState({
                batch: '', year: YEARS[0], term: DRIVE_TERMS[0], link: '', status: 'IDLE'
            });

            // Notice Form State
            const [nForm, setNForm] = useState({
                title: '', message: '', type: 'info', status: 'IDLE'
            });

            const uniqueSubjects = [...new Set(materials.map(m => m.subject).filter(Boolean))].sort();

            // Filter and Sort Materials for Pagination
            const filteredMaterials = useMemo(() => {
                return materials.filter(m =>
                    !adminSearch ||
                    (m.subject && m.subject.toLowerCase().includes(adminSearch.toLowerCase())) ||
                    (m.topic && m.topic.toLowerCase().includes(adminSearch.toLowerCase())) ||
                    (m.teacher && m.teacher.toLowerCase().includes(adminSearch.toLowerCase()))
                ).sort((a, b) => {
                    if (a.category !== b.category) return a.category.localeCompare(b.category);
                    const titleA = a.topic || a.subject;
                    const titleB = b.topic || b.subject;
                    return titleA.localeCompare(titleB);
                });
            }, [materials, adminSearch]);

            const totalPages = Math.ceil(filteredMaterials.length / ITEMS_PER_PAGE);
            const paginatedMaterials = useMemo(() => {
                const start = (currentPage - 1) * ITEMS_PER_PAGE;
                return filteredMaterials.slice(start, start + ITEMS_PER_PAGE);
            }, [filteredMaterials, currentPage]);

            const handleSearchChange = (val) => {
                setAdminSearch(val);
                setCurrentPage(1); // Reset to first page on search
            };

            const handleFileSelect = (e) => {
                const file = e.target.files?.[0];
                if (!file) return;
                if (file.size > 25 * 1024 * 1024) {
                    alert("File too large! Keep under 25MB.");
                    e.target.value = '';
                    return;
                }
                const reader = new FileReader();
                reader.onloadend = () => {
                    setMForm({ ...mForm, fileData: reader.result, fileName: file.name });
                };
                reader.readAsDataURL(file);
            };

            const handleMaterialSubmit = async (e) => {
                e.preventDefault();
                setMForm({ ...mForm, status: 'UPLOADING' });
                try {
                    await onSaveMaterial(mForm, mForm.storageType);
                    setMForm(prev => ({ ...prev, status: 'SUCCESS' }));
                    setTimeout(() => {
                        resetMForm();
                    }, 1500);
                } catch (err) {
                    setMForm({ ...mForm, status: 'ERROR' });
                }
            };

            const handleDriveSubmit = async (e) => {
                e.preventDefault();
                setDForm({ ...dForm, status: 'SAVING' });
                try {
                    await onSaveDrive(dForm);
                    setDForm({ batch: '', year: YEARS[0], term: DRIVE_TERMS[0], link: '', status: 'SUCCESS' });
                    setTimeout(() => setDForm(prev => ({ ...prev, status: 'IDLE' })), 1500);
                } catch (err) {
                    setDForm(prev => ({ ...prev, status: 'IDLE' }));
                }
            };

            const handleNoticeSubmit = async (e) => {
                e.preventDefault();
                setNForm({ ...nForm, status: 'PUBLISHING' });
                try {
                    await onSaveNotice(nForm);
                    setNForm({ title: '', message: '', type: 'info', status: 'SUCCESS' });
                    setTimeout(() => setNForm(prev => ({ ...prev, status: 'IDLE' })), 1500);
                } catch (err) {
                    setNForm(prev => ({ ...prev, status: 'IDLE' }));
                }
            };

            const handleEdit = (m) => {
                setMForm({
                    ...mForm,
                    id: m.id,
                    year: m.year,
                    semester: m.semester,
                    subject: m.subject,
                    topic: m.topic || '',
                    teacher: m.teacher,
                    category: m.category,
                    link: m.link,
                    storageType: m.isFile ? 'file' : 'link',
                    fileData: null, 
                    fileName: '',
                    status: 'IDLE'
                });
                window.scrollTo({ top: 0, behavior: 'smooth' });
            };

            const resetMForm = () => {
                const locks = mForm.locked;
                setMForm({
                    id: null,
                    year: locks.year ? mForm.year : YEARS[0],
                    semester: locks.semester ? mForm.semester : SEMESTERS[0],
                    subject: locks.subject ? mForm.subject : '',
                    topic: '',
                    teacher: locks.teacher ? mForm.teacher : '',
                    category: locks.category ? mForm.category : 'Study Material',
                    link: '', storageType: 'link', fileData: null, fileName: '', status: 'IDLE',
                    locked: locks
                });
            };

            const toggleLock = (field) => {
                setMForm({ ...mForm, locked: { ...mForm.locked, [field]: !mForm.locked[field] } });
            };

            const RenderLabelWithLock = ({ label, field }) => {
                const isLocked = mForm.locked[field];
                return (
                    <div className="flex justify-between items-center mb-1">
                        <label className={`text-xs font-bold ${isLocked ? 'text-amber-400' : 'text-slate-300'} ml-1`}>{label}</label>
                        <button type="button" onClick={() => toggleLock(field)} className="focus:outline-none">
                            {isLocked ? <Lock className="w-3 h-3 text-amber-400" /> : <Unlock className="w-3 h-3 text-slate-600" />}
                        </button>
                    </div>
                );
            };

            // Helper to render filtered list with headers
            let lastCategory = '';

            const NavButton = ({ id, label, icon: Icon, colorClass }) => (
                <button 
                    onClick={() => setViewMode(id)}
                    className={`w-full flex items-center gap-3 px-4 py-3 text-sm font-bold rounded-xl transition-all ${viewMode === id ? `bg-${colorClass}-500/10 text-${colorClass}-400 border border-${colorClass}-500/20` : 'text-slate-400 hover:text-white hover:bg-white/5 border border-transparent'}`}
                >
                    <Icon className="w-4 h-4" />
                    {label}
                </button>
            );

            return (
                <div className="flex flex-col lg:flex-row gap-8 animate-fadeIn">
                    
                    {/* Sidebar Navigation */}
                    <aside className="w-full lg:w-64 flex-shrink-0">
                        <div className="bg-[#151a22] border border-white/5 rounded-[20px] p-4 sticky top-28 shadow-xl">
                            <div className="mb-4 px-2 pt-2 flex items-center gap-2">
                                <Layout className="w-4 h-4 text-slate-500" />
                                <h2 className="text-xs font-bold text-slate-500 uppercase tracking-widest">Dashboard</h2>
                            </div>
                            <nav className="space-y-2">
                                <NavButton id="materials" label="Study Materials" icon={FileText} colorClass="cyan" />
                                <NavButton id="drives" label="Drive Links" icon={HardDrive} colorClass="purple" />
                                <NavButton id="notices" label="Notice Board" icon={Bell} colorClass="amber" />
                            </nav>
                        </div>
                    </aside>

                    {/* Main Content Area */}
                    <div className="flex-1 min-w-0 space-y-8">
                        
                        {viewMode === 'materials' && (
                            <>
                                <div className="bg-[#151a22] border border-white/5 rounded-[24px] p-6 md:p-8 relative overflow-hidden shadow-[0_20px_40px_rgba(0,0,0,0.6)]">
                                    <div className="flex items-center justify-between mb-8 border-b border-white/10 pb-6">
                                        <div className="flex items-center gap-4">
                                            <div className="p-3 rounded-xl shadow-lg bg-gradient-to-br from-emerald-500 to-green-600">
                                                {mForm.id ? <Pencil className="w-6 h-6 text-white" /> : <Upload className="w-6 h-6 text-white" />}
                                            </div>
                                            <div>
                                                <h2 className="text-xl font-bold text-white">{mForm.id ? 'Edit Material' : 'Upload Material'}</h2>
                                                <p className="text-sm text-slate-400">Add resources to the database.</p>
                                            </div>
                                        </div>
                                        {mForm.id && <button onClick={resetMForm} className="text-xs font-bold text-slate-300 hover:text-white flex gap-1"><RotateCcw className="w-3 h-3" /> CANCEL</button>}
                                    </div>
                                    <form onSubmit={handleMaterialSubmit} className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                        <div className="space-y-1">
                                            <RenderLabelWithLock label="ACADEMIC YEAR" field="year" />
                                            <select value={mForm.year} onChange={e => setMForm({ ...mForm, year: e.target.value })} className={`w-full bg-[#0d1016] border ${mForm.locked.year ? 'border-amber-500/30' : 'border-white/10'} rounded-xl px-4 py-3 text-sm text-slate-200 outline-none focus:border-white/20`}>
                                                {YEARS.map(y => <option key={y} value={y} className="bg-[#0d1016]">{y}</option>)}
                                            </select>
                                        </div>
                                        <div className="space-y-1">
                                            <RenderLabelWithLock label="SEMESTER" field="semester" />
                                            <select value={mForm.semester} onChange={e => setMForm({ ...mForm, semester: e.target.value })} className={`w-full bg-[#0d1016] border ${mForm.locked.semester ? 'border-amber-500/30' : 'border-white/10'} rounded-xl px-4 py-3 text-sm text-slate-200 outline-none focus:border-white/20`}>
                                                {SEMESTERS.map(s => <option key={s} value={s} className="bg-[#0d1016]">{s}</option>)}
                                            </select>
                                        </div>
                                        <div className="col-span-1 md:col-span-2 space-y-1">
                                            <RenderLabelWithLock label="SUBJECT NAME" field="subject" />
                                            <input list="subject-options" value={mForm.subject} onChange={e => setMForm({ ...mForm, subject: e.target.value })} className={`w-full bg-[#0d1016] border ${mForm.locked.subject ? 'border-amber-500/30' : 'border-white/10'} rounded-xl px-4 py-3 text-sm text-slate-200 outline-none focus:border-white/20`} required />
                                            <datalist id="subject-options">{uniqueSubjects.map(s => <option key={s} value={s} />)}</datalist>
                                        </div>
                                        {mForm.category !== 'Lab Manual' && (
                                            <div className="col-span-1 md:col-span-2 space-y-2">
                                                <label className="text-xs font-bold text-slate-300 ml-1">TOPIC NAME</label>
                                                <input value={mForm.topic} onChange={e => setMForm({ ...mForm, topic: e.target.value })} className="w-full bg-[#0d1016] border border-white/10 rounded-xl px-4 py-3 text-sm text-slate-200 outline-none focus:border-white/20" required />
                                            </div>
                                        )}
                                        {mForm.category !== 'Lab Manual' && (
                                            <div className="col-span-1 md:col-span-2 space-y-1">
                                                <RenderLabelWithLock label="INSTRUCTOR" field="teacher" />
                                                <input value={mForm.teacher} onChange={e => setMForm({ ...mForm, teacher: e.target.value })} className={`w-full bg-[#0d1016] border ${mForm.locked.teacher ? 'border-amber-500/30' : 'border-white/10'} rounded-xl px-4 py-3 text-sm text-slate-200 outline-none focus:border-white/20`} required />
                                            </div>
                                        )}
                                        <div className="space-y-1">
                                            <RenderLabelWithLock label="CATEGORY" field="category" />
                                            <select value={mForm.category} onChange={e => setMForm({ ...mForm, category: e.target.value })} className={`w-full bg-[#0d1016] border ${mForm.locked.category ? 'border-amber-500/30' : 'border-white/10'} rounded-xl px-4 py-3 text-sm text-slate-200 outline-none focus:border-white/20`}>
                                                {CATEGORIES.map(c => <option key={c} value={c} className="bg-[#0d1016]">{c}</option>)}
                                            </select>
                                        </div>

                                        <div className="col-span-1 md:col-span-2 pt-2 border-t border-white/5">
                                            <div className="flex gap-4 mb-2">
                                                <button type="button" onClick={() => setMForm({ ...mForm, storageType: 'link' })} className={`flex-1 py-2 text-xs font-bold rounded-lg border ${mForm.storageType === 'link' ? 'bg-cyan-500/20 text-cyan-300 border-cyan-500/50' : 'border-white/5'}`}>Link</button>
                                                <button type="button" onClick={() => setMForm({ ...mForm, storageType: 'file' })} className={`flex-1 py-2 text-xs font-bold rounded-lg border ${mForm.storageType === 'file' ? 'bg-purple-500/20 text-purple-300 border-purple-500/50' : 'border-white/5'}`}>Upload</button>
                                            </div>
                                            {mForm.storageType === 'link' ? (
                                                <input value={mForm.link} onChange={e => setMForm({ ...mForm, link: e.target.value })} className="w-full bg-[#0d1016] border border-white/10 rounded-xl px-4 py-3 text-sm text-slate-200 outline-none focus:border-white/20" placeholder="URL..." />
                                            ) : (
                                                <input type="file" onChange={handleFileSelect} className="w-full text-sm text-slate-400 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-xs file:font-semibold file:bg-purple-500/10 file:text-purple-300" />
                                            )}
                                        </div>
                                        <button type="submit" disabled={mForm.status !== 'IDLE'} className={`col-span-1 md:col-span-2 w-full py-4 rounded-xl text-sm font-bold shadow-lg transition-all flex justify-center items-center gap-2 hover:brightness-110 ${mForm.status === 'SUCCESS' ? 'bg-emerald-500 text-white' : 'bg-gradient-to-r from-cyan-500 to-blue-600 text-white'}`}>
                                            {mForm.status === 'IDLE' ? (mForm.id ? 'UPDATE MATERIAL' : 'INITIATE UPLOAD') : mForm.status}
                                        </button>
                                    </form>
                                </div>

                                <div className="bg-[#151a22] border border-white/5 rounded-[24px] p-6 relative overflow-hidden shadow-[0_20px_40px_rgba(0,0,0,0.6)]">
                                    <div className="flex items-center justify-between mb-4 px-2">
                                        <h3 className="text-sm font-bold text-slate-400 uppercase tracking-widest">
                                            Database Entries ({filteredMaterials.length})
                                        </h3>
                                        <div className="relative w-48">
                                            <input type="text" placeholder="Search..." value={adminSearch} onChange={e => handleSearchChange(e.target.value)} className="w-full bg-[#0d1016] border border-white/10 rounded-full pl-8 pr-3 py-1.5 text-xs text-white outline-none focus:border-cyan-500/30" />
                                            <Search className="absolute left-2.5 top-1/2 -translate-y-1/2 w-3 h-3 text-slate-500" />
                                        </div>
                                    </div>
                                    
                                    <div className="space-y-4 max-h-[600px] overflow-y-auto pr-2 custom-scrollbar">
                                        {paginatedMaterials.length === 0 ? (
                                            <p className="text-center text-xs text-slate-500 py-4">No materials found.</p>
                                        ) : (
                                            <div>
                                                {paginatedMaterials.map((m) => {
                                                    const showHeader = m.category !== lastCategory;
                                                    lastCategory = m.category;
                                                    return (
                                                        <React.Fragment key={m.id}>
                                                            {showHeader && (
                                                                <h4 className="text-xs font-bold text-cyan-400 mb-2 mt-4 sticky top-0 bg-[#151a22]/95 backdrop-blur py-1 z-10 first:mt-0">{m.category}</h4>
                                                            )}
                                                            <div className="flex flex-col sm:flex-row items-start sm:items-center justify-between p-3 bg-[linear-gradient(145deg,#151a22,#0d1016)] shadow-[0_0_0_1px_rgba(255,255,255,0.05),0_20px_40px_rgba(0,0,0,0.6)] rounded-[18px] border border-white/5 hover:border-white/10 transition-colors gap-3 mb-2">
                                                                <div className="w-full sm:w-auto">
                                                                    <h4 className="text-sm font-medium text-slate-200">{m.topic || m.subject}</h4>
                                                                    <div className="flex items-center gap-2 mt-1 text-xs text-slate-500">
                                                                        <span className="truncate max-w-[150px]">{m.subject}</span>
                                                                        <span className="px-1.5 py-0.5 rounded text-[10px] border border-white/10">{m.category}</span>
                                                                        <span>â€¢ {m.year}</span>
                                                                    </div>
                                                                </div>
                                                                <div className="flex gap-2 w-full sm:w-auto justify-end">
                                                                    <button onClick={() => handleEdit(m)} className="p-2 rounded bg-slate-800 text-slate-400 hover:text-white transition-colors"><Pencil className="w-3 h-3" /></button>
                                                                    <button onClick={() => onDeleteMaterial(m.id)} className="p-2 rounded bg-rose-900/30 text-rose-400 hover:bg-rose-900/50 transition-colors"><Trash2 className="w-3 h-3" /></button>
                                                                </div>
                                                            </div>
                                                        </React.Fragment>
                                                    );
                                                })}
                                            </div>
                                        )}
                                    </div>

                                    {/* Pagination Controls */}
                                    {filteredMaterials.length > 0 && (
                                        <div className="flex items-center justify-between mt-6 pt-4 border-t border-white/5">
                                            <button 
                                                onClick={() => setCurrentPage(prev => Math.max(prev - 1, 1))}
                                                disabled={currentPage === 1}
                                                className="flex items-center gap-1 text-xs font-bold text-slate-400 hover:text-white disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
                                            >
                                                <ChevronLeft className="w-4 h-4" /> Previous
                                            </button>
                                            <span className="text-xs text-slate-500 font-medium">
                                                Page <span className="text-cyan-400">{currentPage}</span> of {totalPages}
                                            </span>
                                            <button 
                                                onClick={() => setCurrentPage(prev => Math.min(prev + 1, totalPages))}
                                                disabled={currentPage === totalPages}
                                                className="flex items-center gap-1 text-xs font-bold text-slate-400 hover:text-white disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
                                            >
                                                Next <ChevronRight className="w-4 h-4" />
                                            </button>
                                        </div>
                                    )}
                                </div>
                            </>
                        )}

                        {viewMode === 'drives' && (
                            <>
                                <div className="bg-[#151a22] border border-white/5 rounded-[24px] p-6 md:p-8 relative overflow-hidden shadow-[0_20px_40px_rgba(0,0,0,0.6)]">
                                    <div className="flex items-center gap-4 mb-8 border-b border-white/10 pb-6">
                                        <div className="p-3 rounded-xl shadow-lg bg-gradient-to-br from-purple-500 to-pink-600">
                                            <HardDrive className="w-6 h-6 text-white" />
                                        </div>
                                        <div>
                                            <h2 className="text-xl font-bold text-white">Add Drive Link</h2>
                                            <p className="text-sm text-slate-400">Previous year questions & resources.</p>
                                        </div>
                                    </div>
                                    <form onSubmit={handleDriveSubmit} className="grid grid-cols-1 gap-6">
                                        <div className="space-y-2">
                                            <label className="text-xs font-bold text-slate-300 ml-1">BATCH NAME</label>
                                            <input value={dForm.batch} onChange={e => setDForm({ ...dForm, batch: e.target.value })} className="w-full bg-[#0d1016] border border-white/10 rounded-xl px-4 py-3 text-sm text-slate-200 outline-none focus:border-white/20" placeholder="e.g. IEM 2k19" required />
                                        </div>
                                        <div className="grid grid-cols-2 gap-4">
                                            <div className="space-y-2">
                                                <label className="text-xs font-bold text-slate-300 ml-1">YEAR</label>
                                                <select value={dForm.year} onChange={e => setDForm({ ...dForm, year: e.target.value })} className="w-full bg-[#0d1016] border border-white/10 rounded-xl px-4 py-3 text-sm text-slate-200 outline-none focus:border-white/20">
                                                    {YEARS.map(y => <option key={y} value={y} className="bg-[#0d1016]">{y}</option>)}
                                                </select>
                                            </div>
                                            <div className="space-y-2">
                                                <label className="text-xs font-bold text-slate-300 ml-1">TERM</label>
                                                <select value={dForm.term} onChange={e => setDForm({ ...dForm, term: e.target.value })} className="w-full bg-[#0d1016] border border-white/10 rounded-xl px-4 py-3 text-sm text-slate-200 outline-none focus:border-white/20">
                                                    {DRIVE_TERMS.map(t => <option key={t} value={t} className="bg-[#0d1016]">{t}</option>)}
                                                </select>
                                            </div>
                                        </div>
                                        <div className="space-y-2">
                                            <label className="text-xs font-bold text-slate-300 ml-1">DRIVE URL</label>
                                            <input value={dForm.link} onChange={e => setDForm({ ...dForm, link: e.target.value })} type="url" className="w-full bg-[#0d1016] border border-white/10 rounded-xl px-4 py-3 text-sm text-slate-200 outline-none focus:border-white/20" placeholder="https://drive.google.com..." required />
                                        </div>
                                        <button type="submit" disabled={dForm.status !== 'IDLE'} className={`w-full py-4 rounded-xl text-sm font-bold shadow-lg transition-all flex justify-center items-center gap-2 hover:brightness-110 ${dForm.status === 'SUCCESS' ? 'bg-emerald-500 text-white' : 'bg-gradient-to-r from-purple-500 to-pink-600 text-white'}`}>
                                            {dForm.status === 'IDLE' ? 'ADD DRIVE LINK' : dForm.status}
                                        </button>
                                    </form>
                                </div>
                                <div className="bg-[#151a22] border border-white/5 rounded-[24px] p-6 relative overflow-hidden shadow-[0_20px_40px_rgba(0,0,0,0.6)]">
                                    <h3 className="text-sm font-bold text-slate-400 mb-4 px-2 uppercase tracking-widest">Active Links</h3>
                                    <div className="space-y-3 max-h-[400px] overflow-y-auto pr-2 custom-scrollbar">
                                        {driveLinks.length === 0 ? <p className="text-slate-500 text-center">No links added.</p> : driveLinks.map(l => (
                                            <div key={l.id} className="flex items-center justify-between p-3 bg-[#0d1016] rounded-xl border border-white/5">
                                                <div>
                                                    <div className="font-bold text-slate-200 text-sm">{l.batch}</div>
                                                    <div className="text-xs text-slate-500">{l.year} â€¢ {l.term}</div>
                                                </div>
                                                <button onClick={() => onDeleteDrive(l.id)} className="p-2 rounded-lg bg-rose-500/10 text-rose-400 hover:bg-rose-500/20"><Trash2 className="w-4 h-4" /></button>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </>
                        )}

                        {viewMode === 'notices' && (
                            <>
                                <div className="bg-[#151a22] border border-white/5 rounded-[24px] p-6 md:p-8 relative overflow-hidden shadow-[0_20px_40px_rgba(0,0,0,0.6)]">
                                    <div className="flex items-center gap-4 mb-8 border-b border-white/10 pb-6">
                                        <div className="p-3 rounded-xl shadow-lg bg-gradient-to-br from-amber-500 to-orange-600">
                                            <Bell className="w-6 h-6 text-white" />
                                        </div>
                                        <div>
                                            <h2 className="text-xl font-bold text-white">Publish Notice</h2>
                                            <p className="text-sm text-slate-400">Broadcast messages to the home page.</p>
                                        </div>
                                    </div>
                                    <form onSubmit={handleNoticeSubmit} className="grid grid-cols-1 gap-6">
                                        <div className="space-y-2">
                                            <label className="text-xs font-bold text-slate-300 ml-1">NOTICE TITLE</label>
                                            <input value={nForm.title} onChange={e => setNForm({ ...nForm, title: e.target.value })} className="w-full bg-[#0d1016] border border-white/10 rounded-xl px-4 py-3 text-sm text-slate-200 outline-none focus:border-white/20" placeholder="e.g. Class Cancelled" required />
                                        </div>
                                        <div className="space-y-2">
                                            <label className="text-xs font-bold text-slate-300 ml-1">MESSAGE</label>
                                            <textarea value={nForm.message} onChange={e => setNForm({ ...nForm, message: e.target.value })} rows={3} className="w-full bg-[#0d1016] border border-white/10 rounded-xl px-4 py-3 text-sm text-slate-200 outline-none focus:border-white/20" placeholder="Details..." required />
                                        </div>
                                        <button type="submit" disabled={nForm.status !== 'IDLE'} className={`w-full py-4 rounded-xl text-sm font-bold shadow-lg transition-all flex justify-center items-center gap-2 hover:brightness-110 ${nForm.status === 'SUCCESS' ? 'bg-emerald-500 text-white' : 'bg-gradient-to-r from-amber-500 to-orange-600 text-white'}`}>
                                            {nForm.status === 'IDLE' ? 'PUBLISH NOTICE' : nForm.status}
                                        </button>
                                    </form>
                                </div>

                                <div className="bg-[#151a22] border border-white/5 rounded-[24px] p-6 relative overflow-hidden shadow-[0_20px_40px_rgba(0,0,0,0.6)]">
                                     <h3 className="text-sm font-bold text-slate-400 mb-4 px-2 uppercase tracking-widest">Active Notices</h3>
                                     <div className="space-y-3 max-h-[400px] overflow-y-auto pr-2 custom-scrollbar">
                                        {notices.length === 0 ? <p className="text-slate-500 text-center">No notices published.</p> : notices.map(n => (
                                            <div key={n.id} className="flex flex-col p-4 bg-[#0d1016] rounded-xl border border-white/5">
                                                <div className="flex justify-between items-start mb-2">
                                                    <div className="font-bold text-slate-200 text-sm">{n.title}</div>
                                                    <button onClick={() => onDeleteNotice(n.id)} className="p-1.5 rounded-lg bg-rose-500/10 text-rose-400 hover:bg-rose-500/20"><Trash2 className="w-3.5 h-3.5" /></button>
                                                </div>
                                                <p className="text-xs text-slate-400">{n.message}</p>
                                                <div className="flex items-center gap-2 mt-3 text-[10px] text-slate-500">
                                                    <Calendar className="w-3 h-3" /> {new Date(n.date).toLocaleDateString()}
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </>
                        )}
                    </div>
                </div>
            );
        };

        const App = () => {
            // State
            const [token, setToken] = useState(localStorage.getItem('gh_token'));
            const [user, setUser] = useState(null);
            const [view, setView] = useState('home');
            const [materials, setMaterials] = useState([]);
            const [driveLinks, setDriveLinks] = useState([]);
            const [notices, setNotices] = useState([]);
            const [loading, setLoading] = useState(true);
            const [scrolled, setScrolled] = useState(false);
            const [navVisible, setNavVisible] = useState(true);

            // Modals State
            const [notification, setNotification] = useState({ show: false, message: '', type: 'info' });
            const [confirmation, setConfirmation] = useState({ show: false, message: '', onConfirm: null });
            const [showDriveModal, setShowDriveModal] = useState(false);
            const [showDriveResultModal, setShowDriveResultModal] = useState(false);
            const [driveResults, setDriveResults] = useState([]);
            const [showSignatureModal, setShowSignatureModal] = useState(false);
            const [showBookModal, setShowBookModal] = useState(false);

            // Fetch Data
            useEffect(() => {
                const init = async () => {
                    if (token) {
                        try {
                            const u = await githubService.getUser(token);
                            setUser(u);
                        } catch (e) {
                            localStorage.removeItem('gh_token');
                            setToken(null);
                        }
                    }
                    await fetchContent();
                };
                init();
            }, [token]);

            const fetchContent = async () => {
                setLoading(true);
                try {
                    const matPromises = CATEGORIES.map(async (cat) => {
                        const fileName = cat.replace(/\s+/g, '_') + '.json';
                        const data = await githubService.fetchFileContent(fileName, token);
                        return data.map((item) => ({ ...item, category: cat }));
                    });
                    const driveData = await githubService.fetchFileContent('drive_links.json', token);
                    const noticeData = await githubService.fetchFileContent('notices.json', token);
                    
                    const results = await Promise.all(matPromises);
                    setMaterials(results.flat());
                    setDriveLinks(Array.isArray(driveData) ? driveData : []);
                    setNotices(Array.isArray(noticeData) ? noticeData : []);
                } catch (error) {
                    console.error(error);
                } finally {
                    setLoading(false);
                }
            };

            // Scroll Listener for Navbar and Back-to-Top
            useEffect(() => {
                let lastScrollY = window.scrollY;

                const handleScroll = () => {
                    const currentScrollY = window.scrollY;
                    const scrollDiff = currentScrollY - lastScrollY;
                    
                    // Logic to Hide/Show Navbar based on scroll direction
                    // If scrolling down AND past the top area (50px), hide navbar
                    // If scrolling up, show navbar
                    if (currentScrollY > 50) {
                        if (scrollDiff > 0) {
                            setNavVisible(false); // Scrolling Down
                        } else {
                            setNavVisible(true); // Scrolling Up
                        }
                    } else {
                        setNavVisible(true); // Always show at very top
                    }

                    setScrolled(currentScrollY > 300);
                    lastScrollY = currentScrollY;
                };

                window.addEventListener('scroll', handleScroll, { passive: true });
                return () => window.removeEventListener('scroll', handleScroll);
            }, []);

            // Actions
            const notify = (message, type) => {
                setNotification({ show: true, message, type });
            };

            const confirmAction = (message, onConfirm) => {
                setConfirmation({ show: true, message, onConfirm });
            };

            const handleLogin = (u, t) => {
                localStorage.setItem('gh_token', t);
                setToken(t);
                setUser(u);
                setView('admin');
            };

            const handleLogout = () => {
                localStorage.removeItem('gh_token');
                setToken(null);
                setUser(null);
                setView('home');
            };

            const handleSaveMaterial = async (m, type) => {
                if (!token) return;
                let downloadUrl = m.link;
                if (type === 'file') {
                    if (!m.fileData) throw new Error("No file selected");
                    downloadUrl = await githubService.uploadFile(m.fileData, m.fileName, token);
                }

                const newItem = {
                    id: m.id || crypto.randomUUID(),
                    year: m.year, semester: m.semester, subject: m.subject, topic: m.topic || '',
                    teacher: m.teacher, category: m.category, link: downloadUrl,
                    isFile: type === 'file', createdAt: new Date().toISOString(),
                    fileName: m.fileName
                };

                let newMats = [...materials];
                let oldCategory = null;

                if (m.id) {
                    const idx = newMats.findIndex(mat => mat.id === m.id);
                    if (idx !== -1) {
                        oldCategory = newMats[idx].category;
                        newMats[idx] = newItem;
                    }
                } else {
                    newMats.push(newItem);
                }

                setMaterials(newMats);
                
                // Save to GitHub
                const catFileName = newItem.category.replace(/\s+/g, '_') + '.json';
                const catItems = newMats.filter(mat => mat.category === newItem.category);
                await githubService.saveFileContent(catFileName, catItems, `Update ${newItem.category}`, token);

                if (oldCategory && oldCategory !== newItem.category) {
                    const oldFileName = oldCategory.replace(/\s+/g, '_') + '.json';
                    const oldItems = newMats.filter(mat => mat.category === oldCategory);
                    await githubService.saveFileContent(oldFileName, oldItems, `Update ${oldCategory}`, token);
                }
            };

            const handleDeleteMaterial = (id) => {
                confirmAction("Permanently delete this material?", async () => {
                    if (!token) return;
                    const item = materials.find(m => m.id === id);
                    if (!item) return;
                    
                    setMaterials(prev => {
                        const newMats = prev.filter(m => m.id !== id);
                        const fileName = item.category.replace(/\s+/g, '_') + '.json';
                        const catItems = newMats.filter(m => m.category === item.category);
                        
                        githubService.saveFileContent(fileName, catItems, `Delete item from ${item.category}`, token)
                            .then(() => notify("Material deleted", 'success'))
                            .catch(() => notify("Failed to delete", 'error'));
                        
                        return newMats;
                    });
                });
            };

            const handleSaveDrive = async (d) => {
                if (!token) return;
                const newLink = { id: crypto.randomUUID(), batch: d.batch, year: d.year, term: d.term, link: d.link };
                
                setDriveLinks(prev => {
                    const newLinks = [...prev, newLink];
                    githubService.saveFileContent('drive_links.json', newLinks, 'Update Drive Links', token);
                    return newLinks;
                });
            };

            const handleDeleteDrive = (id) => {
                confirmAction("Remove this drive link?", async () => {
                    if (!token) return;
                    setDriveLinks(prev => {
                        const newLinks = prev.filter(l => l.id !== id);
                        githubService.saveFileContent('drive_links.json', newLinks, 'Remove Drive Link', token)
                            .then(() => notify("Link removed", 'success'))
                            .catch(() => notify("Failed to remove link", 'error'));
                        return newLinks;
                    });
                });
            };

            const handleSaveNotice = async (n) => {
                if (!token) return;
                const newNotice = { 
                    id: crypto.randomUUID(), 
                    title: n.title, 
                    message: n.message, 
                    type: n.type,
                    date: new Date().toISOString()
                };
                
                setNotices(prev => {
                    const newNotices = [newNotice, ...prev];
                    githubService.saveFileContent('notices.json', newNotices, 'Publish Notice', token);
                    return newNotices;
                });
            };

            const handleDeleteNotice = (id) => {
                confirmAction("Delete this notice?", async () => {
                    if (!token) return;
                    setNotices(prev => {
                        const newNotices = prev.filter(n => n.id !== id);
                        githubService.saveFileContent('notices.json', newNotices, 'Delete Notice', token)
                            .then(() => notify("Notice deleted", 'success'))
                            .catch(() => notify("Failed to delete notice", 'error'));
                        return newNotices;
                    });
                });
            };

            const handleDriveSearch = (year, term) => {
                const matches = driveLinks.filter(l => l.year === year && l.term === term);
                setDriveResults(matches);
                setShowDriveModal(false);
                setShowDriveResultModal(true);
            };

            return (
                <>
                    <InteractiveGrid />
                    
                    {/* Floating Navbar */}
                    <div className={`fixed top-4 left-0 right-0 z-50 flex justify-center px-4 transition-transform duration-300 ${navVisible ? 'translate-y-0' : '-translate-y-32 lg:translate-y-0'}`}>
                         <nav className="w-full max-w-5xl rounded-2xl bg-[#0e1218]/70 backdrop-blur-xl border border-white/10 shadow-2xl transition-all duration-300">
                            <div className="px-5">
                                <div className="flex flex-col md:flex-row items-center justify-between min-h-[4rem] py-2 md:py-0 gap-3">
                                    <div className="flex items-center gap-3 cursor-pointer group" onClick={() => setView('home')}>
                                        <div className="relative">
                                            <div className="absolute inset-0 bg-cyan-500 blur-lg opacity-20 group-hover:opacity-40 transition-opacity rounded-full"></div>
                                            <img src="iem.png" alt="KUET Logo" className="relative h-9 w-auto object-contain transition-transform group-hover:scale-110" onError={(e) => (e.currentTarget.src = 'https://via.placeholder.com/150?text=KUET')} />
                                        </div>
                                        <span className="text-lg font-bold text-slate-100 tracking-tight">IEM <span className="text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-blue-500">Hub</span></span>
                                    </div>
                                    
                                    <div className="flex items-center gap-2">
                                        <button onClick={() => setShowBookModal(true)} className="flex items-center gap-2 px-3 py-1.5 text-[11px] font-bold text-slate-300 bg-white/5 border border-white/5 rounded-lg hover:bg-white/10 hover:text-white transition-all group hover:border-white/10">
                                            <Book className="w-3.5 h-3.5 text-blue-400 group-hover:scale-110 transition-transform" />
                                            <span className="hidden sm:inline">Find Book</span>
                                        </button>
                                        <button onClick={() => setShowSignatureModal(true)} className="flex items-center gap-2 px-3 py-1.5 text-[11px] font-bold text-slate-300 bg-white/5 border border-white/5 rounded-lg hover:bg-white/10 hover:text-white transition-all group hover:border-white/10">
                                            <PenTool className="w-3.5 h-3.5 text-cyan-400 group-hover:scale-110 transition-transform" />
                                            <span className="hidden sm:inline">Signature</span>
                                        </button>
                                        <div className="hidden md:flex items-center gap-2 text-[10px] font-bold text-slate-400 bg-black/20 px-3 py-1.5 rounded-full border border-white/5">
                                            <div className={`w-1.5 h-1.5 rounded-full ${user ? 'bg-emerald-400 shadow-[0_0_8px_#34d399]' : 'bg-rose-400'}`}></div>
                                            {user ? 'ADMIN' : 'GUEST'}
                                        </div>
                                        {user && view === 'admin' ? (
                                            <button onClick={handleLogout} className="px-3 py-1.5 text-[11px] font-bold text-rose-300 bg-rose-500/10 border border-rose-500/20 rounded-lg hover:bg-rose-500/20 transition-colors">LOGOUT</button>
                                        ) : (
                                            <button onClick={() => setView('login')} className="px-3 py-1.5 text-[11px] font-bold text-cyan-300 bg-cyan-500/10 border border-cyan-500/20 rounded-lg hover:bg-cyan-500/20 transition-colors">LOGIN</button>
                                        )}
                                    </div>
                                </div>
                            </div>
                        </nav>
                    </div>

                    <main className="relative z-10 max-w-7xl mx-auto px-4 pt-28 pb-8 min-h-[85vh]">
                        {view === 'login' && <Login onLogin={handleLogin} notify={notify} />}
                        {view === 'admin' && user && (
                            <Admin 
                                materials={materials} 
                                driveLinks={driveLinks}
                                notices={notices}
                                onSaveMaterial={handleSaveMaterial}
                                onDeleteMaterial={handleDeleteMaterial}
                                onSaveDrive={handleSaveDrive}
                                onDeleteDrive={handleDeleteDrive}
                                onSaveNotice={handleSaveNotice}
                                onDeleteNotice={handleDeleteNotice}
                            />
                        )}
                        {view === 'home' && <Home materials={materials} notices={notices} loading={loading} />}
                    </main>

                    <footer className="relative z-10 py-10 text-center text-slate-600 text-xs">
                        <div className="inline-flex items-center gap-2 px-5 py-2.5 rounded-full bg-[#0e1218]/50 border border-white/5 backdrop-blur-sm hover:border-white/10 transition-colors">
                             <span>Built for KUET IEM</span>
                             <span className="w-1 h-1 rounded-full bg-slate-600"></span>
                             <span>Developed by <span className="text-slate-400 font-bold">SAWON MUKHERJEE</span></span>
                        </div>
                    </footer>

                    {/* Floating Action Button */}
                    {view === 'home' && (
                        <div className="fixed bottom-8 right-8 z-50 animate-fadeIn">
                            <button onClick={() => setShowDriveModal(true)} className="group relative w-14 h-14 md:w-auto md:h-12 md:px-5 bg-indigo-600 hover:bg-indigo-500 rounded-full shadow-lg shadow-indigo-500/30 flex items-center justify-center text-white hover:scale-105 transition-all overflow-hidden">
                                <HardDrive className="w-5 h-5 md:mr-2 relative z-10" />
                                <span className="hidden md:inline text-xs font-bold relative z-10">Drive Links</span>
                            </button>
                        </div>
                    )}

                    <button 
                        onClick={() => window.scrollTo({ top: 0, behavior: 'smooth' })} 
                        className={`fixed bottom-8 left-8 z-50 w-12 h-12 bg-[#1e293b]/80 hover:bg-[#334155] border border-white/10 rounded-full shadow-lg flex items-center justify-center text-white hover:scale-110 transition-all duration-300 backdrop-blur-md ${scrolled ? 'opacity-100 translate-y-0 pointer-events-auto' : 'opacity-0 translate-y-10 pointer-events-none'}`}
                    >
                        <ArrowUp className="w-5 h-5" />
                    </button>

                    {/* Modals */}
                    {notification.show && <NotificationModal message={notification.message} type={notification.type} onClose={() => setNotification({ ...notification, show: false })} />}
                    {confirmation.show && <ConfirmationModal message={confirmation.message} onConfirm={confirmation.onConfirm} onClose={() => setConfirmation({ ...confirmation, show: false })} />}
                    {showDriveModal && <DriveFinderModal onClose={() => setShowDriveModal(false)} onSearch={handleDriveSearch} />}
                    {showDriveResultModal && <DriveResultModal results={driveResults} onClose={() => setShowDriveResultModal(false)} />}
                    {showSignatureModal && <SignatureModal onClose={() => setShowSignatureModal(false)} />}
                    {showBookModal && <BookSearchModal onClose={() => setShowBookModal(false)} />}
                </>
            );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
