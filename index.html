<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KUET IEM - Industrial Study Hub</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Google Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; }
        .animate-fadeIn { animation: fadeIn 0.5s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: rgba(255, 255, 255, 0.05); }
        ::-webkit-scrollbar-thumb { background: rgba(255, 255, 255, 0.1); border-radius: 4px; }

        /* Dropdown Option Styling */
        select option { background-color: #0d1016 !important; color: #e2e8f0 !important; padding: 10px; }

        /* Grid Pattern Styles */
        .grid-pattern-container {
            position: fixed; top: -50%; left: 0; right: 0; height: 200%;
            transform: skewY(12deg); z-index: 0; pointer-events: none;
            mask-image: radial-gradient(600px circle at center, white, transparent);
            -webkit-mask-image: radial-gradient(600px circle at center, white, transparent);
            opacity: 0.5;
        }
        
        /* Modal Animation */
        .modal-enter { animation: modalIn 0.2s ease-out forwards; }
        @keyframes modalIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
    </style>
</head>
<body class="bg-[#0e1116] text-[#e7ecf3] selection:bg-cyan-500/30 selection:text-cyan-100 min-h-screen overflow-x-hidden relative" style="background: radial-gradient(circle at top, #1c2128, #0e1116);">

    <div class="grid-pattern-container"><canvas id="interactive-grid-canvas" class="w-full h-full"></canvas></div>
    <div id="root" class="relative z-10"></div>
    <div id="modal-root" class="relative z-50"></div>

    <script>
        // --- INTERACTIVE GRID BACKGROUND LOGIC ---
        (function setupInteractiveGrid() {
            const canvas = document.getElementById('interactive-grid-canvas');
            const ctx = canvas.getContext('2d');
            let width, height, mouseX = -1000, mouseY = -1000;
            const squareSize = 40; 

            function resize() {
                const rect = canvas.parentElement.getBoundingClientRect();
                width = rect.width; height = rect.height;
                canvas.width = width; canvas.height = height;
                draw();
            }

            window.addEventListener('mousemove', (e) => {
                const rect = canvas.parentElement.getBoundingClientRect();
                const skewRad = 12 * (Math.PI / 180);
                const skewOffset = (e.clientX - (window.innerWidth / 2)) * Math.tan(skewRad);
                mouseX = e.clientX - rect.left;
                mouseY = (e.clientY - rect.top) - skewOffset;
            });

            function draw() {
                ctx.clearRect(0, 0, width, height);
                const cols = Math.ceil(width / squareSize);
                const rows = Math.ceil(height / squareSize);
                
                ctx.strokeStyle = "rgba(255, 255, 255, 0.05)";
                ctx.lineWidth = 1;
                ctx.beginPath();
                for (let i = 0; i <= cols; i++) { ctx.moveTo(i * squareSize, 0); ctx.lineTo(i * squareSize, height); }
                for (let j = 0; j <= rows; j++) { ctx.moveTo(0, j * squareSize); ctx.lineTo(width, j * squareSize); }
                ctx.stroke();

                if (mouseX > 0 && mouseY > 0) {
                    const hoverCol = Math.floor(mouseX / squareSize);
                    const hoverRow = Math.floor(mouseY / squareSize);
                    ctx.fillStyle = "rgba(100, 150, 255, 0.2)";
                    ctx.fillRect(hoverCol * squareSize + 1, hoverRow * squareSize + 1, squareSize - 2, squareSize - 2);
                    ctx.fillStyle = "rgba(100, 150, 255, 0.05)";
                    ctx.fillRect(hoverCol * squareSize + 1, (hoverRow - 1) * squareSize + 1, squareSize - 2, squareSize - 2);
                    ctx.fillRect(hoverCol * squareSize + 1, (hoverRow + 1) * squareSize + 1, squareSize - 2, squareSize - 2);
                    ctx.fillRect((hoverCol - 1) * squareSize + 1, hoverRow * squareSize + 1, squareSize - 2, squareSize - 2);
                    ctx.fillRect((hoverCol + 1) * squareSize + 1, hoverRow * squareSize + 1, squareSize - 2, squareSize - 2);
                }
                requestAnimationFrame(draw);
            }
            window.addEventListener('resize', resize);
            resize();
            requestAnimationFrame(draw);
        })();
    </script>

    <script type="module">
        // --- GITHUB CONFIGURATION ---
        const GITHUB_CONFIG = {
            owner: "Sawon76", 
            repo: "iem",        
            branch: "main"
        };

        // --- Constants ---
        const YEARS = ['1st Year', '2nd Year', '3rd Year', '4th Year'];
        const SEMESTERS = ['1st Semester', '2nd Semester'];
        const CATEGORIES = ['Study Material', 'Term Questions', 'CT Questions', 'Lab Manual', 'Books'];
        const DRIVE_TERMS = ['1st Term', '2nd Term'];

        // --- Utilities ---
        function utf8_to_b64(str) {
            return window.btoa(unescape(encodeURIComponent(str)));
        }

        function b64_to_utf8(str) {
            return decodeURIComponent(escape(window.atob(str)));
        }

        function getCategoryStyles(category) {
            // Gradient mappings based on the reference design
            switch(category) {
                case 'Study Material': return { 
                    emoji: 'ðŸ“–',
                    btnGradient: 'bg-[linear-gradient(145deg,#ff8a3d,#d95c1e)]',
                };
                case 'Term Questions': return { 
                    emoji: 'ðŸ§¾',
                    btnGradient: 'bg-[linear-gradient(145deg,#22c55e,#15803d)]',
                };
                case 'CT Questions': return { 
                    emoji: 'ðŸ“',
                    btnGradient: 'bg-[linear-gradient(145deg,#a78bfa,#6d28d9)]',
                };
                case 'Lab Manual': return { 
                    emoji: 'ðŸ§ª',
                    // Using a reddish gradient for Lab Manual as a distinct 5th color
                    btnGradient: 'bg-[linear-gradient(145deg,#f43f5e,#be123c)]',
                };
                case 'Books': return { 
                    emoji: 'ðŸ“š',
                    btnGradient: 'bg-[linear-gradient(145deg,#3b82f6,#1d4ed8)]',
                };
                default: return { 
                    emoji: 'ðŸ“',
                    btnGradient: 'bg-[linear-gradient(145deg,#64748b,#475569)]',
                };
            }
        }

        // --- State ---
        const state = {
            token: localStorage.getItem('gh_token') || null,
            user: null,
            isAdmin: false,
            view: 'home',
            materials: [],
            driveLinks: [], 
            loading: true,
            
            filterYear: 'All', 
            filterSem: 'All',  
            filterSubject: 'All', 
            filterCategory: 'All',
            searchSub: '',
            
            // Admin Search State
            adminSearch: '',

            // Floating Drive Finder State
            showDriveModal: false,
            showDriveResultModal: false,
            driveFinder: { year: YEARS[0], term: DRIVE_TERMS[0], results: [] },
            
            // Book Search Modal State
            showBookModal: false,
            bookFinder: { query: '', results: [], loading: false },
            
            // Gmail Signature Modal State
            showSignatureModal: false,

            adminViewMode: 'materials', 

            adminForm: {
                id: null,
                year: '1st Year',
                semester: '1st Semester',
                subject: '',
                topic: '', 
                teacher: '',
                category: 'Study Material',
                link: '',
                storageType: 'link', 
                fileData: null,
                fileName: '',
                status: 'IDLE',
                locked: { year: false, semester: false, teacher: false, subject: false, category: false }
            },

            driveForm: {
                batch: '',
                year: YEARS[0], 
                term: DRIVE_TERMS[0], 
                link: '',
                status: 'IDLE'
            },
            
            // UI Modals
            notification: { show: false, message: '', type: 'info' },
            confirmation: { show: false, message: '', onConfirm: null }
        };

        // --- Initialization ---
        async function init() {
            if (state.token) {
                try {
                    const user = await githubAPI('/user');
                    state.user = user;
                    state.isAdmin = true;
                } catch (e) {
                    localStorage.removeItem('gh_token');
                    state.token = null;
                }
            }
            fetchData();
        }

        async function githubAPI(endpoint, method = 'GET', body = null) {
            const headers = {
                'Accept': 'application/vnd.github.v3+json',
                ...(state.token && { 'Authorization': `token ${state.token}` })
            };
            const options = { method, headers };
            if (body) options.body = JSON.stringify(body);
            const res = await fetch(`https://api.github.com${endpoint}`, options);
            if (!res.ok) throw new Error(`GitHub API Error: ${res.status}`);
            return res.json();
        }

        async function fetchData() {
            state.loading = true;
            render();
            try {
                const materialPromises = CATEGORIES.map(async (category) => {
                    const fileName = category.replace(/\s+/g, '_') + '.json';
                    try {
                        let data = [];
                        if (state.token) {
                            const file = await githubAPI(`/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/contents/${fileName}`);
                            data = JSON.parse(b64_to_utf8(file.content));
                        } else {
                            const url = `https://raw.githubusercontent.com/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/${GITHUB_CONFIG.branch}/${fileName}?t=${Date.now()}`;
                            const res = await fetch(url, { cache: "no-store" });
                            if (res.ok) data = await res.json();
                        }
                        return data.map(item => ({ ...item, category }));
                    } catch (err) { return []; }
                });

                const drivePromise = (async () => {
                    const fileName = 'drive_links.json';
                    try {
                        let data = [];
                        if (state.token) {
                            const file = await githubAPI(`/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/contents/${fileName}`);
                            data = JSON.parse(b64_to_utf8(file.content));
                        } else {
                            const url = `https://raw.githubusercontent.com/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/${GITHUB_CONFIG.branch}/${fileName}?t=${Date.now()}`;
                            const res = await fetch(url, { cache: "no-store" });
                            if (res.ok) data = await res.json();
                        }
                        return data;
                    } catch (err) { return []; }
                })();

                const [materials, driveLinks] = await Promise.all([Promise.all(materialPromises), drivePromise]);
                state.materials = materials.flat();
                state.driveLinks = driveLinks;
            } catch (err) { console.error("Fetch failed:", err); } finally { state.loading = false; render(); }
        }

        async function saveCategoryFile(category) {
            const fileName = category.replace(/\s+/g, '_') + '.json';
            const categoryMaterials = state.materials.filter(m => m.category === category);
            await pushFileToGitHub(fileName, categoryMaterials, `Update ${category}`);
        }

        async function saveDriveLinks() {
            await pushFileToGitHub('drive_links.json', state.driveLinks, 'Update Drive Links');
        }

        async function pushFileToGitHub(fileName, contentData, message) {
            let sha = null;
            try {
                const current = await githubAPI(`/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/contents/${fileName}`);
                sha = current.sha;
            } catch (e) {}
            
            await githubAPI(`/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/contents/${fileName}`, 'PUT', {
                message: message,
                content: utf8_to_b64(JSON.stringify(contentData, null, 2)),
                sha: sha
            });
        }

        async function uploadFileToGitHub(fileData, fileName) {
            const base64Content = fileData.split(',')[1];
            const path = `uploads/${Date.now()}_${fileName.replace(/\s/g, '_')}`;
            await githubAPI(`/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/contents/${path}`, 'PUT', {
                message: `Upload ${fileName}`,
                content: base64Content
            });
            return `https://raw.githubusercontent.com/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/${GITHUB_CONFIG.branch}/${path}`;
        }

        // --- Actions ---
        window.setView = (view) => { state.view = view; render(); };
        window.setFilter = (k, v) => { 
            state[k] = v; 
            if (k === 'filterYear' || k === 'filterSem') state.filterSubject = 'All';
            render(); 
        };
        window.setAdminSearch = (val) => { state.adminSearch = val; render(); };
        
        window.updateAdminForm = (k, v, shouldRender = true) => { state.adminForm[k] = v; if (shouldRender) render(); };
        window.updateDriveForm = (k, v, shouldRender = true) => { state.driveForm[k] = v; if (shouldRender) render(); };
        window.setAdminViewMode = (mode) => { state.adminViewMode = mode; render(); };

        window.toggleDriveModal = () => {
            state.showDriveModal = !state.showDriveModal;
            state.showDriveResultModal = false;
            state.driveFinder.results = [];
            render();
        };
        
        window.closeDriveResultModal = () => { state.showDriveResultModal = false; render(); };
        window.updateDriveFinder = (k, v) => { state.driveFinder[k] = v; render(); };
        window.findDriveLink = () => {
            const { year, term } = state.driveFinder;
            const matches = state.driveLinks.filter(l => l.year === year && l.term === term);
            state.driveFinder.results = matches;
            state.showDriveResultModal = true;
            render();
        };

        // --- NEW ACTION: Signature Modal ---
        window.toggleSignatureModal = () => {
            state.showSignatureModal = !state.showSignatureModal;
            render();
        };

        // --- NEW ACTION: Book Modal ---
        window.toggleBookModal = () => {
            state.showBookModal = !state.showBookModal;
            render();
        };
        
        window.updateBookQuery = (val) => {
            state.bookFinder.query = val;
            // render(); // Removed to prevent flickering while typing
        };

        window.handleBookSearch = async (e) => {
            e.preventDefault();
            if (!state.bookFinder.query) return;
            
            // Clear previous results and show loading
            state.bookFinder.loading = true;
            state.bookFinder.results = [];
            render();
            
            try {
                // Use Google Books API as the backend for search functionality
                const res = await fetch(`https://www.googleapis.com/books/v1/volumes?q=${encodeURIComponent(state.bookFinder.query)}&maxResults=20`);
                const data = await res.json();
                state.bookFinder.results = data.items || [];
            } catch (err) {
                notify("Book search failed", 'error');
            }
            state.bookFinder.loading = false;
            render();
        };

        window.handleCategoryChange = (value) => {
            state.adminForm.category = value;
            render();
        };

        window.toggleLock = (field) => { state.adminForm.locked[field] = !state.adminForm.locked[field]; render(); };

        // --- Notification Actions ---
        window.notify = (message, type = 'info') => {
            state.notification = { show: true, message, type };
            render();
        };
        window.closeNotification = () => {
            state.notification = { show: false, message: '', type: 'info' };
            render();
        };

        window.ask = (message, onConfirm) => {
            state.confirmation = { show: true, message, onConfirm };
            render();
        };
        window.closeConfirmation = () => {
            state.confirmation = { show: false, message: '', onConfirm: null };
            render();
        };
        window.confirmAction = () => {
            if (state.confirmation.onConfirm) state.confirmation.onConfirm();
            closeConfirmation();
        };

        window.handleLogin = async (e) => {
            e.preventDefault();
            const token = e.target.token.value.trim();
            if (!token.startsWith('ghp_') && !token.startsWith('github_pat_')) { 
                notify("Invalid Token format. Must start with ghp_ or github_pat_", 'error'); 
                return; 
            }
            localStorage.setItem('gh_token', token);
            state.token = token;
            await init(); 
            if (state.user) {
                state.view = 'admin'; 
            } else {
                notify("Token verification failed. Check permissions.", 'error');
            }
            render();
        };

        window.handleLogout = () => { localStorage.removeItem('gh_token'); state.token = null; state.user = null; state.isAdmin = false; state.view = 'home'; render(); };

        window.handleFileSelect = (e) => {
            const file = e.target.files[0];
            if (!file) return;
            if (file.size > 25 * 1024 * 1024) { 
                notify("File too large! Keep under 25MB.", 'error'); 
                e.target.value = ''; 
                return; 
            }
            const reader = new FileReader();
            reader.onloadend = () => { state.adminForm.fileData = reader.result; state.adminForm.fileName = file.name; render(); };
            reader.readAsDataURL(file);
        };
        
        window.handleDownload = (fileData, fileName) => {
            const link = document.createElement('a');
            link.href = fileData;
            link.download = fileName || 'download';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        };

        // --- Download Animation Logic ---
        window.initiateDownload = (btn, isFile, dataStr, nameStr, gradientClass) => {
            // Find the parent card wrapper
            const card = btn.closest('.group');
            if (!card || card.dataset.downloading === "true") return;
            card.dataset.downloading = "true";

            // Create Full Card Overlay
            const overlay = document.createElement('div');
            // Remove any shadow classes from gradientClass if they exist to prevent artifacts inside overflow-hidden
            const bgClass = gradientClass.split(' ').filter(c => c.startsWith('bg-')).join(' ');
            
            overlay.className = `absolute inset-0 z-50 flex items-center justify-center ${bgClass} transition-opacity duration-300`;
            overlay.innerHTML = '<span id="dl-percent" class="text-4xl md:text-5xl font-black text-white font-mono drop-shadow-md select-none">0%</span>';
            
            card.appendChild(overlay);

            let progress = 0;
            const duration = 400; // 400ms loading
            const startTime = performance.now();

            function animate(currentTime) {
                const elapsed = currentTime - startTime;
                progress = Math.min((elapsed / duration) * 100, 100);

                const text = overlay.querySelector('#dl-percent');
                if (text) text.innerText = `${Math.floor(progress)}%`;

                if (progress < 100) {
                    requestAnimationFrame(animate);
                } else {
                    // Animation Complete
                    setTimeout(() => {
                        // Trigger Actual Action
                        if (isFile) {
                            handleDownload(dataStr, nameStr);
                        } else {
                            window.open(dataStr, '_blank');
                        }

                        // Remove overlay
                        overlay.classList.add('opacity-0');
                        setTimeout(() => {
                            overlay.remove();
                            card.dataset.downloading = "false";
                        }, 300);
                    }, 200);
                }
            }

            requestAnimationFrame(animate);
        };

        window.handleAdminSubmit = async (e) => {
            e.preventDefault();
            const form = state.adminForm;
            state.adminForm.status = 'UPLOADING'; render();

            try {
                let downloadUrl = form.link;
                if (form.storageType === 'file') {
                    if(!form.fileData) throw new Error("No file selected");
                    downloadUrl = await uploadFileToGitHub(form.fileData, form.fileName);
                }

                const newItem = {
                    id: form.id || crypto.randomUUID(),
                    year: form.year, semester: form.semester, subject: form.subject, topic: form.topic || '', 
                    teacher: form.teacher, category: form.category, link: downloadUrl, 
                    isFile: form.storageType === 'file', createdAt: new Date().toISOString()
                };

                let oldCategory = null;
                let newMaterials = [...state.materials];
                if (form.id) {
                    const idx = newMaterials.findIndex(m => m.id === form.id);
                    if (idx !== -1) { oldCategory = newMaterials[idx].category; newMaterials[idx] = newItem; }
                } else { newMaterials.push(newItem); }

                state.materials = newMaterials;
                await saveCategoryFile(newItem.category);
                if (oldCategory && oldCategory !== newItem.category) await saveCategoryFile(oldCategory);
                
                state.adminForm.status = 'SUCCESS'; render();
                setTimeout(() => { resetAdminForm(); render(); }, 1500);
            } catch (err) { 
                notify("Error: " + err.message, 'error'); 
                state.adminForm.status = 'ERROR'; 
                render(); 
            }
        };

        window.handleDriveSubmit = async (e) => {
            e.preventDefault();
            const form = state.driveForm;
            state.driveForm.status = 'SAVING'; render();
            try {
                const newLink = { id: crypto.randomUUID(), batch: form.batch, year: form.year, term: form.term, link: form.link };
                state.driveLinks = [...state.driveLinks, newLink];
                await saveDriveLinks();
                state.driveForm = { batch: '', year: YEARS[0], term: DRIVE_TERMS[0], link: '', status: 'SUCCESS' };
                render();
                setTimeout(() => { state.driveForm.status = 'IDLE'; render(); }, 1500);
            } catch (err) { 
                notify("Error: " + err.message, 'error'); 
                state.driveForm.status = 'IDLE'; 
                render(); 
            }
        };

        window.handleDelete = (id) => {
            ask("Permanently delete this material?", async () => {
                try {
                    const item = state.materials.find(m => m.id === id);
                    if (!item) return;
                    const cat = item.category;
                    state.materials = state.materials.filter(m => m.id !== id);
                    await saveCategoryFile(cat);
                    notify("Material deleted successfully", 'success');
                    render();
                } catch (err) { 
                    notify("Delete Failed: " + err.message, 'error'); 
                }
            });
        };

        window.handleDeleteDriveLink = (id) => {
            ask("Remove this drive link?", async () => {
                try {
                    state.driveLinks = state.driveLinks.filter(l => l.id !== id);
                    await saveDriveLinks();
                    notify("Link removed successfully", 'success');
                    render();
                } catch (err) { 
                    notify("Delete Failed: " + err.message, 'error'); 
                }
            });
        };

        window.handleEdit = (id) => {
            const item = state.materials.find(m => m.id === id);
            if (!item) return;
            state.adminForm = { ...state.adminForm, ...item, id: item.id, topic: item.topic || '', storageType: item.isFile ? 'file' : 'link', status: 'IDLE' };
            window.scrollTo({top:0, behavior:'smooth'});
            render();
        };

        window.cancelEdit = () => { resetAdminForm(); render(); };

        function resetAdminForm() {
            const current = state.adminForm; const locks = current.locked;
            state.adminForm = {
                id: null, year: locks.year ? current.year : YEARS[0], semester: locks.semester ? current.semester : SEMESTERS[0], 
                subject: locks.subject ? current.subject : '', topic: '', teacher: locks.teacher ? current.teacher : '', 
                category: locks.category ? current.category : 'Study Material', 
                link: '', storageType: 'link', fileData: null, fileName: '', status: 'IDLE', locked: locks
            };
        }

        // --- Render Helpers ---
        function renderNav() {
            return `
                <nav class="relative z-20 mx-4 mt-4 rounded-2xl bg-[#151a22] border border-white/5 shadow-lg shadow-black/20">
                    <div class="max-w-7xl mx-auto px-6">
                        <div class="flex flex-col md:flex-row items-center justify-between min-h-[5rem] py-4 md:py-0 gap-4">
                            <div class="flex items-center gap-3 cursor-pointer" onclick="setView('home')">
                                <img src="iem.png" alt="KUET Logo" class="h-12 w-auto object-contain" onerror="this.src='https://via.placeholder.com/150?text=KUET'"/>
                                <span class="text-xl font-bold text-slate-200">KUET IEM Study Hub</span>
                            </div>
                            <div class="flex items-center gap-4">
                                <button onclick="toggleBookModal()" class="flex items-center gap-2 px-4 py-2 text-xs font-bold text-slate-300 bg-[#0d1016] border border-white/10 rounded-xl hover:bg-white/5 hover:text-white transition-colors group">
                                    <i data-lucide="book" class="w-4 h-4 text-emerald-400 group-hover:scale-110 transition-transform"></i>
                                    <span>Find Books</span>
                                </button>
                                <button onclick="toggleSignatureModal()" class="flex items-center gap-2 px-4 py-2 text-xs font-bold text-slate-300 bg-[#0d1016] border border-white/10 rounded-xl hover:bg-white/5 hover:text-white transition-colors group">
                                    <i data-lucide="pen-tool" class="w-4 h-4 text-cyan-400 group-hover:scale-110 transition-transform"></i>
                                    <span>Gmail Signature</span>
                                </button>
                                <div class="hidden md:flex items-center gap-2 text-xs font-medium text-slate-400 bg-black/20 px-3 py-1 rounded-full border border-white/5"><div class="w-2 h-2 rounded-full ${state.user ? 'bg-emerald-400 shadow-[0_0_8px_#34d399]' : 'bg-rose-400'}"></div>${state.user ? 'ADMIN ONLINE' : 'ONLINE'}</div>
                                ${state.isAdmin ? `<button onclick="handleLogout()" class="px-4 py-2 text-xs font-bold text-rose-300 bg-rose-500/10 border border-rose-500/20 rounded-xl hover:bg-rose-500/20">LOGOUT</button>` : `<button onclick="setView('login')" class="px-4 py-2 text-xs font-bold text-cyan-300 bg-cyan-500/10 border border-cyan-500/20 rounded-xl hover:bg-cyan-500/20">ADMIN LOGIN</button>`}
                            </div>
                        </div>
                    </div>
                </nav>
            `;
        }
        function renderLogin() { return `<div class="flex justify-center items-center py-20 animate-fadeIn"><div class="w-full max-w-md bg-[#151a22] border border-white/5 p-8 rounded-[18px] shadow-[0_20px_40px_rgba(0,0,0,0.6)]"><div class="text-center mb-8"><div class="inline-block p-4 bg-cyan-500/10 rounded-full border border-cyan-500/20 mb-4"><i data-lucide="key" class="w-8 h-8 text-cyan-400"></i></div><h2 class="text-2xl font-bold text-white">Admin Authentication</h2></div><form onsubmit="handleLogin(event)" class="space-y-6"><div><label class="block text-xs font-bold text-slate-300 mb-2 ml-1">GITHUB TOKEN</label><input name="token" type="password" class="w-full bg-[#0d1016] border border-white/10 text-white p-4 rounded-xl outline-none focus:border-cyan-500/50 transition-colors" required /></div><button type="submit" class="w-full py-3 rounded-xl text-sm font-bold text-white bg-gradient-to-r from-cyan-500 to-blue-600 hover:brightness-110 transition-all">VERIFY</button></form></div></div>`; }
        function renderFloatingButton() { return `<div class="fixed bottom-8 right-8 z-50 animate-fadeIn"><button onclick="toggleDriveModal()" class="w-auto h-14 px-6 bg-slate-700 hover:bg-slate-600 rounded-full shadow-lg shadow-black/40 flex items-center justify-center text-white hover:scale-110 transition-all group gap-2"><i data-lucide="hard-drive" class="w-6 h-6 group-hover:animate-bounce"></i><span class="text-xs font-bold">Drive</span></button></div>`; }
        function renderScrollTopButton() {
             const isVisible = window.scrollY > 300;
             const visibilityClass = isVisible ? 'opacity-100 translate-y-0 pointer-events-auto' : 'opacity-0 translate-y-10 pointer-events-none';
            return `<button onclick="window.scrollTo({top: 0, behavior: 'smooth'})" id="scrollTopBtn" class="fixed bottom-8 left-8 z-50 w-14 h-14 bg-slate-700 hover:bg-slate-600 rounded-full shadow-lg shadow-black/40 flex items-center justify-center text-white hover:scale-110 transition-all duration-300 ${visibilityClass}"><i data-lucide="arrow-up" class="w-6 h-6"></i></button>`;
        }
        
        function renderAdmin() {
            const f = state.adminForm;
            const uniqueSubjects = [...new Set(state.materials.map(m => m.subject).filter(Boolean))].sort();
            const renderLabelWithLock = (label, field) => { const isLocked = f.locked[field]; return `<div class="flex justify-between items-center mb-1"><label class="text-xs font-bold ${isLocked ? 'text-amber-400' : 'text-slate-300'} ml-1">${label}</label><button type="button" onclick="toggleLock('${field}')" class="focus:outline-none"><i data-lucide="${isLocked ? 'lock' : 'unlock'}" class="w-3 h-3 ${isLocked ? 'text-amber-400' : 'text-slate-600'}"></i></button></div>`; };
            const categories = Object.keys(state.materials.reduce((acc, item) => { const cat = item.category || 'Uncategorized'; if (!acc[cat]) acc[cat] = []; acc[cat].push(item); return acc; }, {})).sort();

            const isLabManual = f.category === 'Lab Manual';
            const adminQuery = state.adminSearch.toLowerCase();

            return `
                <div class="max-w-4xl mx-auto space-y-8 animate-fadeIn">
                    <div class="flex justify-center mb-6"><div class="bg-[#151a22] p-1 rounded-full border border-white/5 flex shadow-lg"><button onclick="setAdminViewMode('materials')" class="px-6 py-2 rounded-full text-sm font-bold transition-all ${state.adminViewMode === 'materials' ? 'bg-cyan-500/10 text-cyan-300 border border-cyan-500/20 shadow' : 'text-slate-400 hover:text-white'}">Study Materials</button><button onclick="setAdminViewMode('drives')" class="px-6 py-2 rounded-full text-sm font-bold transition-all ${state.adminViewMode === 'drives' ? 'bg-purple-500/10 text-purple-300 border border-purple-500/20 shadow' : 'text-slate-400 hover:text-white'}">Previous Year Drives</button></div></div>
                    ${state.adminViewMode === 'materials' ? `
                        <div class="bg-[#151a22] border border-white/5 rounded-[18px] p-6 md:p-8 relative overflow-hidden shadow-[0_20px_40px_rgba(0,0,0,0.6)]">
                            <div class="flex items-center justify-between mb-8 border-b border-white/10 pb-6"><div class="flex items-center gap-4"><div class="p-3 rounded-xl shadow-lg bg-gradient-to-br from-emerald-500 to-green-600"><i data-lucide="${f.id ? 'pencil' : 'upload'}" class="w-6 h-6 text-white"></i></div><div><h2 class="text-xl font-bold text-white">${f.id ? 'Edit Material' : 'Upload Material'}</h2><p class="text-sm text-slate-400">Add resources to the database.</p></div></div>${f.id ? `<button onclick="cancelEdit()" class="text-xs font-bold text-slate-300 hover:text-white flex gap-1"><i data-lucide="rotate-ccw" class="w-3 h-3"></i> CANCEL</button>` : ''}</div>
                            <form onsubmit="handleAdminSubmit(event)" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div class="space-y-1">${renderLabelWithLock('ACADEMIC YEAR', 'year')}<select onchange="updateAdminForm('year', this.value)" class="w-full bg-[#0d1016] border ${f.locked.year ? 'border-amber-500/30' : 'border-white/10'} rounded-xl px-4 py-3 text-sm text-slate-200 outline-none focus:border-white/20">${YEARS.map(y => `<option value="${y}" class="bg-[#0d1016]" ${f.year === y ? 'selected' : ''}>${y}</option>`).join('')}</select></div>
                                <div class="space-y-1">${renderLabelWithLock('SEMESTER', 'semester')}<select onchange="updateAdminForm('semester', this.value)" class="w-full bg-[#0d1016] border ${f.locked.semester ? 'border-amber-500/30' : 'border-white/10'} rounded-xl px-4 py-3 text-sm text-slate-200 outline-none focus:border-white/20">${SEMESTERS.map(s => `<option value="${s}" class="bg-[#0d1016]" ${f.semester === s ? 'selected' : ''}>${s}</option>`).join('')}</select></div>
                                <div class="col-span-1 md:col-span-2 space-y-1">${renderLabelWithLock('SUBJECT NAME', 'subject')}<input list="subject-options" value="${f.subject}" oninput="updateAdminForm('subject', this.value, false)" class="w-full bg-[#0d1016] border ${f.locked.subject ? 'border-amber-500/30' : 'border-white/10'} rounded-xl px-4 py-3 text-sm text-slate-200 outline-none focus:border-white/20" required /><datalist id="subject-options">${uniqueSubjects.map(s => `<option value="${s}">`).join('')}</datalist></div>
                                
                                ${!isLabManual ? `<div class="col-span-1 md:col-span-2 space-y-2"><label class="text-xs font-bold text-slate-300 ml-1">TOPIC NAME</label><input value="${f.topic}" oninput="updateAdminForm('topic', this.value, false)" class="w-full bg-[#0d1016] border border-white/10 rounded-xl px-4 py-3 text-sm text-slate-200 outline-none focus:border-white/20" required /></div>` : ''}
                                
                                ${!isLabManual ? `<div class="col-span-1 md:col-span-2 space-y-1">${renderLabelWithLock('INSTRUCTOR', 'teacher')}<input value="${f.teacher}" oninput="updateAdminForm('teacher', this.value, false)" class="w-full bg-[#0d1016] border ${f.locked.teacher ? 'border-amber-500/30' : 'border-white/10'} rounded-xl px-4 py-3 text-sm text-slate-200 outline-none focus:border-white/20" required /></div>` : ''}
                                
                                <div class="space-y-1">${renderLabelWithLock('CATEGORY', 'category')}<select onchange="handleCategoryChange(this.value)" class="w-full bg-[#0d1016] border ${f.locked.category ? 'border-amber-500/30' : 'border-white/10'} rounded-xl px-4 py-3 text-sm text-slate-200 outline-none focus:border-white/20">${CATEGORIES.map(c => `<option value="${c}" class="bg-[#0d1016]" ${f.category === c ? 'selected' : ''}>${c}</option>`).join('')}</select></div>
                                
                                <div class="col-span-1 md:col-span-2 pt-2 border-t border-white/5"><div class="flex gap-4 mb-2"><button type="button" onclick="updateAdminForm('storageType', 'link')" class="flex-1 py-2 text-xs font-bold rounded-lg border ${f.storageType === 'link' ? 'bg-cyan-500/20 text-cyan-300 border-cyan-500/50' : 'border-white/5'}">Link</button><button type="button" onclick="updateAdminForm('storageType', 'file')" class="flex-1 py-2 text-xs font-bold rounded-lg border ${f.storageType === 'file' ? 'bg-purple-500/20 text-purple-300 border-purple-500/50' : 'border-white/5'}">Upload</button></div>${f.storageType === 'link' ? `<input value="${f.link}" oninput="updateAdminForm('link', this.value, false)" class="w-full bg-[#0d1016] border border-white/10 rounded-xl px-4 py-3 text-sm text-slate-200 outline-none focus:border-white/20" placeholder="URL..." />` : `<input type="file" onchange="handleFileSelect(event)" class="w-full text-sm text-slate-400 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-xs file:font-semibold file:bg-purple-500/10 file:text-purple-300" />`}</div>
                                <button type="submit" ${f.status !== 'IDLE' ? 'disabled' : ''} class="col-span-1 md:col-span-2 w-full py-4 rounded-xl text-sm font-bold shadow-lg transition-all flex justify-center items-center gap-2 hover:brightness-110 ${f.status === 'SUCCESS' ? 'bg-emerald-500 text-white' : 'bg-gradient-to-r from-cyan-500 to-blue-600 text-white'}">${f.status === 'IDLE' ? (f.id ? 'UPDATE MATERIAL' : 'INITIATE UPLOAD') : f.status}</button>
                            </form>
                        </div>
                        <div class="bg-[#151a22] border border-white/5 rounded-[18px] p-6 relative overflow-hidden shadow-[0_20px_40px_rgba(0,0,0,0.6)]">
                            <div class="flex items-center justify-between mb-4 px-2">
                                <h3 class="text-sm font-bold text-slate-400 uppercase tracking-widest">Database Entries</h3>
                                <div class="relative w-48">
                                    <input type="text" placeholder="Search..." value="${state.adminSearch}" oninput="setAdminSearch(this.value)" class="w-full bg-[#0d1016] border border-white/10 rounded-full pl-8 pr-3 py-1.5 text-xs text-white outline-none focus:border-cyan-500/30">
                                    <i data-lucide="search" class="absolute left-2.5 top-1/2 -translate-y-1/2 w-3 h-3 text-slate-500"></i>
                                </div>
                            </div>
                            <div class="space-y-4 max-h-[400px] overflow-y-auto pr-2">
                                ${categories.map(cat => {
                                    const filteredItems = state.materials.filter(m => m.category === cat && (
                                        !adminQuery || 
                                        (m.subject && m.subject.toLowerCase().includes(adminQuery)) || 
                                        (m.topic && m.topic.toLowerCase().includes(adminQuery)) ||
                                        (m.teacher && m.teacher.toLowerCase().includes(adminQuery))
                                    ));
                                    if(filteredItems.length === 0) return '';
                                    return `<div><h4 class="text-xs font-bold text-cyan-400 mb-2 sticky top-0 bg-[#151a22]/95 backdrop-blur py-1 z-10">${cat}</h4>${filteredItems.map(m => {const styles = getCategoryStyles(m.category); return `<div class="flex flex-col sm:flex-row items-start sm:items-center justify-between p-3 bg-[linear-gradient(145deg,#151a22,#0d1016)] shadow-[0_0_0_1px_rgba(255,255,255,0.05),0_20px_40px_rgba(0,0,0,0.6)] rounded-[18px] border border-white/5 hover:border-white/10 transition-colors gap-3"><div class="w-full sm:w-auto"><h4 class="text-sm font-medium text-slate-200">${m.topic || m.subject}</h4><div class="flex items-center gap-2 mt-1 text-xs text-slate-500"><span class="truncate max-w-[150px]">${m.subject}</span><span class="px-1.5 py-0.5 rounded text-[10px] border border-white/10">${m.category}</span><span>â€¢ ${m.year}</span></div></div><div class="flex gap-2 w-full sm:w-auto justify-end"><button onclick="handleEdit('${m.id}')" class="p-2 rounded bg-slate-800 text-slate-400 hover:text-white transition-colors"><i data-lucide="pencil" class="w-3 h-3"></i></button><button onclick="handleDelete('${m.id}')" class="p-2 rounded bg-rose-900/30 text-rose-400 hover:bg-rose-900/50 transition-colors"><i data-lucide="trash-2" class="w-3 h-3"></i></button></div></div>`}).join('')}</div>`
                                }).join('')}
                                ${state.materials.length === 0 ? '<p class="text-center text-xs text-slate-500 py-4">No materials uploaded yet.</p>' : ''}
                            </div>
                        </div>
                    ` : `
                        <div class="bg-[#151a22] border border-white/5 rounded-[18px] p-6 md:p-8 relative overflow-hidden shadow-[0_20px_40px_rgba(0,0,0,0.6)]"><div class="flex items-center gap-4 mb-8 border-b border-white/10 pb-6"><div class="p-3 rounded-xl shadow-lg bg-gradient-to-br from-purple-500 to-pink-600"><i data-lucide="hard-drive" class="w-6 h-6 text-white"></i></div><div><h2 class="text-xl font-bold text-white">Add Drive Link</h2><p class="text-sm text-slate-400">Previous year questions & resources.</p></div></div><form onsubmit="handleDriveSubmit(event)" class="grid grid-cols-1 gap-6"><div class="space-y-2"><label class="text-xs font-bold text-slate-300 ml-1">BATCH NAME</label><input value="${state.driveForm.batch}" oninput="updateDriveForm('batch', this.value, false)" class="w-full bg-[#0d1016] border border-white/10 rounded-xl px-4 py-3 text-sm text-slate-200 outline-none focus:border-white/20" placeholder="e.g. IEM 2k19" required /></div><div class="grid grid-cols-2 gap-4"><div class="space-y-2"><label class="text-xs font-bold text-slate-300 ml-1">YEAR</label><select onchange="updateDriveForm('year', this.value)" class="w-full bg-[#0d1016] border border-white/10 rounded-xl px-4 py-3 text-sm text-slate-200 outline-none focus:border-white/20">${YEARS.map(y => `<option value="${y}" class="bg-[#0d1016]" ${state.driveForm.year === y ? 'selected' : ''}>${y}</option>`).join('')}</select></div><div class="space-y-2"><label class="text-xs font-bold text-slate-300 ml-1">TERM</label><select onchange="updateDriveForm('term', this.value)" class="w-full bg-[#0d1016] border border-white/10 rounded-xl px-4 py-3 text-sm text-slate-200 outline-none focus:border-white/20">${DRIVE_TERMS.map(t => `<option value="${t}" class="bg-[#0d1016]" ${state.driveForm.term === t ? 'selected' : ''}>${t}</option>`).join('')}</select></div></div><div class="space-y-2"><label class="text-xs font-bold text-slate-300 ml-1">DRIVE URL</label><input value="${state.driveForm.link}" oninput="updateDriveForm('link', this.value, false)" type="url" class="w-full bg-[#0d1016] border border-white/10 rounded-xl px-4 py-3 text-sm text-slate-200 outline-none focus:border-white/20" placeholder="https://drive.google.com..." required /></div><button type="submit" ${state.driveForm.status !== 'IDLE' ? 'disabled' : ''} class="w-full py-4 rounded-xl text-sm font-bold shadow-lg transition-all flex justify-center items-center gap-2 hover:brightness-110 ${state.driveForm.status === 'SUCCESS' ? 'bg-emerald-500 text-white' : 'bg-gradient-to-r from-purple-500 to-pink-600 text-white'}">${state.driveForm.status === 'IDLE' ? 'ADD DRIVE LINK' : state.driveForm.status}</button></form></div>
                        <div class="bg-[#151a22] border border-white/5 rounded-[18px] p-6 relative overflow-hidden shadow-[0_20px_40px_rgba(0,0,0,0.6)]"><h3 class="text-sm font-bold text-slate-400 mb-4 px-2 uppercase tracking-widest">Active Links</h3><div class="space-y-3 max-h-[400px] overflow-y-auto pr-2">${state.driveLinks.length === 0 ? '<p class="text-slate-500 text-center">No links added.</p>' : state.driveLinks.map(l => `<div class="flex items-center justify-between p-3 bg-[#0d1016] rounded-xl border border-white/5"><div><div class="font-bold text-slate-200 text-sm">${l.batch}</div><div class="text-xs text-slate-500">${l.year} â€¢ ${l.term}</div></div><button onclick="handleDeleteDriveLink('${l.id}')" class="p-2 rounded-lg bg-rose-500/10 text-rose-400 hover:bg-rose-500/20"><i data-lucide="trash-2" class="w-4 h-4"></i></button></div>`).join('')}</div></div>
                    `}
                </div>
            `;
        }

        function renderHome() {
            const yearSemFiltered = state.materials.filter(m => {
                const y = state.filterYear === 'All' || m.year === state.filterYear;
                const s = state.filterSem === 'All' || m.semester === state.filterSem;
                return y && s;
            });
            const availableSubjects = [...new Set(yearSemFiltered.map(m => m.subject || ''))].filter(Boolean).sort();
            const finalFiltered = yearSemFiltered.filter(m => {
                const subMatch = state.filterSubject === 'All' || m.subject === state.filterSubject;
                const catMatch = state.filterCategory === 'All' || m.category === state.filterCategory;
                const q = state.searchSub.toLowerCase();
                const searchMatch = !q || (m.subject && m.subject.toLowerCase().includes(q)) || (m.topic && m.topic.toLowerCase().includes(q)) || (m.teacher && m.teacher.toLowerCase().includes(q));
                return subMatch && catMatch && searchMatch;
            });

            // --- RECENT UPLOADS LOGIC ---
            const now = new Date();
            const oneDayAgo = new Date(now.getTime() - (24 * 60 * 60 * 1000));

            const recentMaterials = [...state.materials]
                .filter(m => m.createdAt && new Date(m.createdAt) > oneDayAgo) // Uploaded in last 24h
                .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));

            const groupedMaterials = finalFiltered.reduce((acc, item) => {
                const subj = item.subject || 'Uncategorized';
                if (!acc[subj]) acc[subj] = [];
                acc[subj].push(item);
                return acc;
            }, {});
            const sortedSubjects = Object.keys(groupedMaterials).sort();

            return `
                <div class="space-y-8 animate-fadeIn">
                    <div class="bg-[#151a22] border border-white/5 p-4 md:p-6 rounded-[18px] shadow-[0_20px_40px_rgba(0,0,0,0.6)] relative z-30">
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4 md:gap-6">
                            <div><label class="block text-[10px] font-bold text-slate-400 mb-2 ml-1">YEAR</label><div class="relative"><select onchange="setFilter('filterYear', this.value)" class="appearance-none w-full bg-[#0d1016] border border-white/10 text-slate-200 h-12 px-4 pr-10 rounded-full text-sm outline-none cursor-pointer hover:border-cyan-500/30 transition-colors"><option value="All" class="bg-[#0d1016]" ${state.filterYear === 'All' ? 'selected' : ''}>All Years</option>${YEARS.map(y => `<option value="${y}" class="bg-[#0d1016]" ${state.filterYear === y ? 'selected' : ''}>${y}</option>`).join('')}</select><i data-lucide="chevron-down" class="absolute right-4 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-500 pointer-events-none"></i></div></div>
                            <div><label class="block text-[10px] font-bold text-slate-400 mb-2 ml-1">SEMESTER</label><div class="relative"><select onchange="setFilter('filterSem', this.value)" class="appearance-none w-full bg-[#0d1016] border border-white/10 text-slate-200 h-12 px-4 pr-10 rounded-full text-sm outline-none cursor-pointer hover:border-cyan-500/30 transition-colors"><option value="All" class="bg-[#0d1016]" ${state.filterSem === 'All' ? 'selected' : ''}>All Semesters</option>${SEMESTERS.map(s => `<option value="${s}" class="bg-[#0d1016]" ${state.filterSem === s ? 'selected' : ''}>${s}</option>`).join('')}</select><i data-lucide="chevron-down" class="absolute right-4 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-500 pointer-events-none"></i></div></div>
                            <div><label class="block text-[10px] font-bold text-slate-400 mb-2 ml-1">SUBJECT</label><div class="relative"><select onchange="setFilter('filterSubject', this.value)" class="appearance-none w-full bg-[#0d1016] border border-white/10 text-slate-200 h-12 px-4 pr-10 rounded-full text-sm outline-none cursor-pointer hover:border-cyan-500/30 transition-colors" ${availableSubjects.length === 0 ? 'disabled' : ''}><option value="All" class="bg-[#0d1016]">All Subjects</option>${availableSubjects.map(sub => `<option value="${sub}" class="bg-[#0d1016]" ${state.filterSubject === sub ? 'selected' : ''}>${sub}</option>`).join('')}</select><i data-lucide="chevron-down" class="absolute right-4 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-500 pointer-events-none"></i></div></div>
                            <div><label class="block text-[10px] font-bold text-slate-400 mb-2 ml-1">CATEGORY</label><div class="relative"><select onchange="setFilter('filterCategory', this.value)" class="appearance-none w-full bg-[#0d1016] border border-white/10 text-slate-200 h-12 px-4 pr-10 rounded-full text-sm outline-none cursor-pointer hover:border-cyan-500/30 transition-colors"><option value="All" class="bg-[#0d1016]">All Categories</option>${CATEGORIES.map(c => `<option value="${c}" class="bg-[#0d1016]" ${state.filterCategory === c ? 'selected' : ''}>${c}</option>`).join('')}</select><i data-lucide="chevron-down" class="absolute right-4 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-500 pointer-events-none"></i></div></div>
                            <div><label class="block text-[10px] font-bold text-slate-400 mb-2 ml-1">SEARCH</label><div class="relative"><input id="search-input" oninput="setFilter('searchSub', this.value)" value="${state.searchSub}" class="w-full bg-[#0d1016] border border-white/10 text-slate-200 h-12 pl-10 pr-4 rounded-full text-sm outline-none placeholder-slate-600 focus:border-cyan-500/30 transition-colors" placeholder="Topic, Subject..." /><i data-lucide="search" class="absolute left-4 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-500 pointer-events-none"></i></div></div>
                        </div>
                    </div>

                    ${state.loading ? `<div class="text-center py-20 opacity-50 text-sm tracking-widest text-cyan-400 animate-pulse">LOADING...</div>` :
                      `
                      <!-- RECENT UPLOADS SECTION -->
                      ${recentMaterials.length > 0 && state.filterSubject === 'All' && state.searchSub === '' ? `
                          <div class="bg-[#151a22] border-2 border-dashed border-white/10 rounded-[18px] p-6 md:p-8 relative overflow-hidden">
                              <div class="flex items-center gap-3 mb-6">
                                  <div class="p-2 bg-gradient-to-br from-amber-500/20 to-orange-600/20 rounded-lg border border-amber-500/30">
                                      <i data-lucide="sparkles" class="w-5 h-5 text-amber-400"></i>
                                  </div>
                                  <h2 class="text-2xl font-bold text-white tracking-wide">Recent Uploads</h2>
                              </div>
                              <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                  ${recentMaterials.map(m => renderCard(m, true)).join('')}
                              </div>
                          </div>
                      ` : ''}

                      ${finalFiltered.length === 0 ? `<div class="text-center py-20 opacity-50 text-slate-500">No materials found.</div>` :
                      `<div class="space-y-12">
                          ${sortedSubjects.map(subject => `
                              <div class="animate-fadeIn">
                                  <div class="flex items-center gap-3 mb-6 border-b border-white/10 pb-4">
                                      <div class="p-2 bg-gradient-to-br from-cyan-500/20 to-blue-600/20 rounded-lg border border-cyan-500/30"><i data-lucide="book-open" class="w-5 h-5 text-cyan-400"></i></div>
                                      <h2 class="text-2xl font-bold text-white tracking-wide">${subject}</h2>
                                      <span class="text-xs font-medium text-slate-500 bg-[#0d1016] border border-white/5 px-2 py-1 rounded-full ml-auto">${groupedMaterials[subject].length} Resources</span>
                                  </div>
                                  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">${groupedMaterials[subject].map(m => renderCard(m)).join('')}</div>
                              </div>
                          `).join('')}
                      </div>`}
                      `
                    }
                </div>
            `;
        }

        function renderCard(data, isCompact = false) {
            const isFile = !!data.fileData;
            const safeData = isFile ? encodeURIComponent(data.fileData) : encodeURIComponent(data.link);
            const safeName = isFile ? encodeURIComponent(data.fileName || 'download') : 'link';
            
            const displayTitle = data.topic || data.subject; 
            const fullTitle = data.topic ? `${data.subject}: ${data.topic}` : data.subject;

            const styles = getCategoryStyles(data.category);
            const semShort = data.semester ? data.semester.split(' ')[0] : 'N/A';
            const yearShort = data.year ? data.year : 'N/A';

            // Common Click Handler string - Now passing styles.btnGradient
            const clickHandler = `onclick="initiateDownload(this, ${isFile}, decodeURIComponent('${safeData}'), decodeURIComponent('${safeName}'), '${styles.btnGradient}')"`;

            if (isCompact) {
                return `
                <div class="group relative flex bg-[#151a22] border-2 border-white/10 shadow-[0_4px_10px_rgba(0,0,0,0.3)] rounded-xl transition-all duration-300 hover:-translate-y-0.5 overflow-hidden h-28">
                    
                    <!-- Animated Gradient Background -->
                    <div class="absolute top-0 right-0 h-full w-12 group-hover:w-full transition-all duration-[400ms] ease-out ${styles.btnGradient}"></div>

                    <div class="flex-1 p-4 flex flex-col justify-between min-w-0 relative z-10">
                        <div class="flex justify-between items-start gap-3">
                            <div class="flex-1 overflow-hidden">
                                <h3 class="text-sm font-bold text-slate-200 group-hover:text-white transition-colors duration-[400ms] line-clamp-2 leading-tight" title="${fullTitle}">${displayTitle}</h3>
                                <p class="text-[11px] text-slate-500 group-hover:text-white/80 transition-colors duration-[400ms] mt-1 truncate">${data.subject}</p>
                            </div>
                        </div>
                        
                        <div class="flex items-center gap-2 text-[10px] text-slate-500 group-hover:text-white/80 transition-colors duration-[400ms] mt-2">
                            <span class="bg-white/5 group-hover:bg-white/20 border border-white/5 group-hover:border-white/20 px-1.5 py-0.5 rounded transition-colors duration-[400ms]">${yearShort}</span>
                            <span class="truncate max-w-[100px] flex items-center gap-1"><i data-lucide="user" class="w-3 h-3"></i> ${data.teacher}</span>
                        </div>
                    </div>
                    
                    <!-- Button Container (Right Side) -->
                    <div class="relative z-20 w-12 h-full border-l-[1.5px] border-white/20 group-hover:border-white/30 transition-colors duration-[400ms]">
                        <button ${clickHandler} class="w-full h-full flex items-center justify-center text-white hover:scale-110 transition-transform cursor-pointer opacity-80 hover:opacity-100" title="${isFile ? 'Retrieve' : 'Download'}">
                            <i data-lucide="${isFile ? 'database' : 'download'}" class="w-5 h-5"></i>
                        </button>
                    </div>
                </div>
            `;
            }

            return `
                <div class="group relative flex flex-col bg-[linear-gradient(145deg,#151a22,#0d1016)] border-2 border-white/10 shadow-[0_20px_40px_rgba(0,0,0,0.6)] rounded-[18px] hover:-translate-y-1 transition-transform duration-300 overflow-hidden">
                    
                    <!-- Animated Gradient Background (Bottom Up) -->
                    <div class="absolute bottom-0 left-0 w-full h-[52px] group-hover:h-full transition-all duration-[400ms] ease-out ${styles.btnGradient}"></div>

                    <!-- Content Wrapper -->
                    <div class="p-[26px] flex-1 relative z-10">
                        <!-- Header -->
                        <div class="flex items-center gap-[14px] mb-[12px]">
                            <div class="text-[42px] leading-none select-none">${styles.emoji}</div>
                            <div class="text-[24px] font-semibold text-[#e7ecf3] group-hover:text-white transition-colors duration-[400ms] leading-tight tracking-tight">${data.category}</div>
                        </div>

                        <!-- Divider -->
                        <div class="h-px bg-white/10 group-hover:bg-white/20 my-[14px] transition-colors duration-[400ms]"></div>

                        <!-- Content Rows -->
                        <div class="text-[15px] text-[#e7ecf3] group-hover:text-white/90 opacity-90 mb-[6px] font-normal transition-colors duration-[400ms]">${yearShort} | ${semShort}</div>
                        <div class="text-[15px] text-[#e7ecf3] group-hover:text-white font-medium mb-[6px] line-clamp-2 transition-colors duration-[400ms]" title="${fullTitle}">${fullTitle}</div>
                        <div class="text-[15px] text-[#aab1bc] group-hover:text-white/80 mt-[4px] truncate transition-colors duration-[400ms]">Prof. ${data.teacher}</div>
                    </div>

                    <!-- Footer / Full Width Button -->
                    <button ${clickHandler} class="relative z-20 w-full py-3 text-white cursor-pointer flex justify-center items-center hover:brightness-115 hover:opacity-100 transition-all opacity-80 border-t-[1.5px] border-white/20 group-hover:border-white/0" title="${isFile ? 'Retrieve File' : 'Download Link'}">
                        <i data-lucide="${isFile ? 'database' : 'download'}" class="w-5 h-5 mr-2"></i> ${isFile ? 'Retrieve' : 'Download'}
                    </button>
                </div>
            `;
        }
        
        function renderDriveFinderModal() {
            const { year, term } = state.driveFinder;
            return `<div class="fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-fadeIn"><div class="w-full max-w-sm bg-slate-900 border border-purple-500/30 rounded-3xl shadow-2xl overflow-hidden relative"><div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-purple-500 via-pink-500 to-purple-500"></div><button onclick="toggleDriveModal()" class="absolute top-4 right-4 text-slate-400 hover:text-white"><i data-lucide="x" class="w-6 h-6"></i></button><div class="p-8 text-center"><div class="w-16 h-16 bg-purple-500/10 rounded-full flex items-center justify-center mx-auto mb-6 border border-purple-500/20"><i data-lucide="search" class="w-8 h-8 text-purple-400"></i></div><h2 class="text-2xl font-bold text-white mb-2">Find Archives</h2><p class="text-sm text-slate-400 mb-8">Select session details below</p><div class="space-y-4 mb-8 text-left"><div><label class="text-xs font-bold text-slate-500 ml-1">YEAR</label><select onchange="updateDriveFinder('year', this.value)" class="w-full bg-[#0d1016] border border-white/10 rounded-xl px-4 py-3 text-sm text-white outline-none focus:border-purple-500/50">${YEARS.map(y => `<option value="${y}" class="bg-[#0d1016]" ${year === y ? 'selected' : ''}>${y}</option>`).join('')}</select></div><div><label class="text-xs font-bold text-slate-500 ml-1">TERM</label><select onchange="updateDriveFinder('term', this.value)" class="w-full bg-[#0d1016] border border-white/10 rounded-xl px-4 py-3 text-sm text-white outline-none focus:border-purple-500/50">${DRIVE_TERMS.map(t => `<option value="${t}" class="bg-[#0d1016]" ${term === t ? 'selected' : ''}>${t}</option>`).join('')}</select></div></div><button onclick="findDriveLink()" class="w-full py-4 bg-white text-black font-bold rounded-xl hover:bg-slate-200 transition-colors flex items-center justify-center gap-2">SHOW DRIVE <i data-lucide="arrow-right" class="w-4 h-4"></i></button></div></div></div>`;
        }

        function renderDriveResultModal() {
            const { results } = state.driveFinder;
            return `<div class="fixed inset-0 z-[70] flex items-center justify-center p-4 bg-black/80 backdrop-blur-md animate-fadeIn"><div class="w-full max-w-md bg-slate-900 border border-purple-500/50 rounded-3xl shadow-[0_0_50px_rgba(168,85,247,0.2)] overflow-hidden relative transform scale-100 transition-transform"><div class="flex justify-between items-center p-6 border-b border-white/10 bg-white/5"><h2 class="text-lg font-bold text-white flex items-center gap-2"><i data-lucide="folder-open" class="w-5 h-5 text-purple-400"></i> Results Found</h2><button onclick="closeDriveResultModal()" class="p-2 rounded-full hover:bg-white/10 text-slate-400 hover:text-white transition-all"><i data-lucide="x" class="w-6 h-6"></i></button></div><div class="p-6 max-h-[60vh] overflow-y-auto">${results.length === 0 ? `<div class="text-center py-10"><div class="inline-block p-4 bg-rose-500/10 rounded-full mb-3"><i data-lucide="alert-circle" class="w-8 h-8 text-rose-400"></i></div><p class="text-slate-300 font-medium">No archives found for this session.</p><button onclick="closeDriveResultModal()" class="mt-4 text-xs text-purple-400 hover:text-purple-300 hover:underline">Try a different year</button></div>` : `<div class="space-y-4">${results.map(l => `<div class="bg-gradient-to-br from-purple-900/30 to-black border border-purple-500/30 rounded-2xl p-6 hover:border-purple-500/60 transition-all group shadow-lg"><div class="flex justify-between items-start mb-4"><span class="text-xs font-bold text-purple-300 bg-purple-500/20 px-3 py-1 rounded-full border border-purple-500/20 tracking-wider">BATCH</span><div class="text-right"><div class="text-xs font-bold text-white">${l.year}</div><div class="text-[10px] text-slate-400 uppercase">${l.term}</div></div></div><h3 class="text-2xl font-bold text-white mb-6 tracking-tight">${l.batch}</h3><a href="${l.link}" target="_blank" class="flex items-center justify-center gap-3 w-full py-4 rounded-xl bg-purple-600 hover:bg-purple-500 text-white font-bold text-base transition-all shadow-lg shadow-purple-900/20 group-hover:scale-[1.02]"><i data-lucide="external-link" class="w-5 h-5"></i> OPEN GOOGLE DRIVE</a></div>`).join('')}</div>`}</div></div></div>`;
        }

        // --- Signature Modal ---
        function renderSignatureModal() {
            return `
                <div class="fixed inset-0 z-[90] flex items-center justify-center p-4 bg-black/80 backdrop-blur-md animate-fadeIn">
                    <div class="w-full max-w-6xl h-[90vh] bg-slate-900 border border-white/10 rounded-3xl shadow-2xl overflow-hidden relative flex flex-col">
                        <div class="flex justify-between items-center p-4 border-b border-white/10 bg-white/5">
                            <h2 class="text-lg font-bold text-white flex items-center gap-3">
                                <div class="p-2 bg-cyan-500/10 rounded-lg border border-cyan-500/20">
                                    <i data-lucide="pen-tool" class="w-5 h-5 text-cyan-400"></i>
                                </div>
                                Gmail Signature Creator
                            </h2>
                            <button onclick="toggleSignatureModal()" class="p-2 rounded-full hover:bg-white/10 text-slate-400 hover:text-white transition-all">
                                <i data-lucide="x" class="w-6 h-6"></i>
                            </button>
                        </div>
                        <div class="flex-1 bg-white relative">
                            <iframe src="https://sawon76.github.io/gmail-signature/" class="w-full h-full border-0" title="Gmail Signature Creator"></iframe>
                        </div>
                    </div>
                </div>
            `;
        }

        // --- Book Search Modal ---
        function renderBookSearchModal() {
            if (!state.showBookModal) return '';
            
            return `
                <div class="fixed inset-0 z-[80] flex items-center justify-center p-4 bg-black/80 backdrop-blur-md animate-fadeIn">
                    <div class="w-full max-w-4xl h-[85vh] bg-slate-900 border border-emerald-500/30 rounded-3xl shadow-2xl overflow-hidden relative flex flex-col">
                        <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-emerald-500 via-teal-500 to-emerald-500"></div>
                        
                        <!-- Header -->
                        <div class="flex justify-between items-center p-6 border-b border-white/10 bg-white/5">
                            <h2 class="text-xl font-bold text-white flex items-center gap-3">
                                <div class="w-10 h-10 bg-emerald-500/10 rounded-full flex items-center justify-center border border-emerald-500/20">
                                    <i data-lucide="book" class="w-5 h-5 text-emerald-400"></i>
                                </div>
                                Find Books
                            </h2>
                            <button onclick="toggleBookModal()" class="p-2 rounded-full hover:bg-white/10 text-slate-400 hover:text-white transition-all">
                                <i data-lucide="x" class="w-6 h-6"></i>
                            </button>
                        </div>

                        <!-- Content -->
                        <div class="flex-1 flex flex-col overflow-hidden">
                            <!-- Search Bar -->
                            <div class="p-6 pb-2">
                                <form onsubmit="handleBookSearch(event)" class="relative flex gap-3">
                                    <div class="relative flex-1">
                                        <input id="book-search-input" type="text" value="${state.bookFinder.query}" oninput="updateBookQuery(this.value)" class="w-full bg-black/40 border border-white/10 rounded-xl pl-12 pr-4 py-4 text-white outline-none focus:border-emerald-500/50 transition-all placeholder-slate-500" placeholder="Search by Title, Author, or ISBN..." autofocus />
                                        <i data-lucide="search" class="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-500"></i>
                                    </div>
                                    <button type="submit" class="px-8 py-4 bg-emerald-600 hover:bg-emerald-500 text-white font-bold rounded-xl transition-all flex items-center gap-2">
                                        <i data-lucide="arrow-right" class="w-5 h-5"></i>
                                        <span class="hidden sm:inline">Search</span>
                                    </button>
                                </form>
                            </div>

                            <!-- Results Area -->
                            <div class="flex-1 overflow-y-auto p-6 pt-2 custom-scrollbar">
                                ${state.bookFinder.loading ? `
                                    <div class="flex flex-col items-center justify-center h-64 text-emerald-400 animate-pulse">
                                        <i data-lucide="loader-2" class="w-10 h-10 mb-4 animate-spin"></i>
                                        <span class="text-sm font-mono uppercase tracking-widest">Searching Archives...</span>
                                    </div>
                                ` : state.bookFinder.results.length > 0 ? `
                                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                                        ${state.bookFinder.results.map(item => {
                                            const info = item.volumeInfo;
                                            const thumbnail = info.imageLinks?.thumbnail || 'https://via.placeholder.com/128x192?text=No+Cover';
                                            const secureThumbnail = thumbnail.replace('http:', 'https:');
                                            
                                            // Construct Search Links
                                            const query = encodeURIComponent(state.bookFinder.query);
                                            const zLibLink = `https://z-lib.gd/s/${query}`;
                                            const liber3Link = `https://liber3.eth.limo/#/search?q=${query}`;
                                            const libgenLiLink = `https://libgen.li/index.php?req=${query}`;
                                            
                                            return `
                                            <div class="bg-[#0e1116] border border-white/10 rounded-xl overflow-hidden hover:border-emerald-500/30 transition-all flex flex-col group">
                                                <div class="flex p-4 gap-4">
                                                    <img src="${secureThumbnail}" alt="${info.title}" class="w-20 h-28 object-cover rounded-md shadow-lg bg-slate-800" />
                                                    <div class="flex-1 min-w-0">
                                                        <h3 class="text-sm font-bold text-white leading-tight line-clamp-2 mb-1" title="${info.title}">${info.title}</h3>
                                                        <p class="text-xs text-emerald-400 mb-2 truncate">${info.authors ? info.authors[0] : 'Unknown Author'}</p>
                                                        <div class="text-[10px] text-slate-500 font-mono mb-2">${info.publishedDate ? info.publishedDate.substring(0,4) : 'N/A'} â€¢ ${info.pageCount || '?'} Pages</div>
                                                    </div>
                                                </div>
                                                
                                                <!-- Download Links Grid -->
                                                <div class="mt-auto border-t border-white/5 bg-white/[0.02] p-2 grid grid-cols-2 gap-2">
                                                    <a href="${info.previewLink}" target="_blank" class="py-2 flex items-center justify-center gap-1.5 text-[10px] font-bold text-slate-300 bg-white/5 rounded hover:bg-white/10 hover:text-white transition-colors">
                                                        <i data-lucide="eye" class="w-3 h-3"></i> Preview
                                                    </a>
                                                    <a href="${zLibLink}" target="_blank" class="py-2 flex items-center justify-center gap-1.5 text-[10px] font-bold text-blue-400 bg-blue-500/10 rounded hover:bg-blue-500/20 hover:text-blue-300 transition-colors">
                                                        <i data-lucide="download" class="w-3 h-3"></i> Z-Lib
                                                    </a>
                                                    <a href="${liber3Link}" target="_blank" class="py-2 flex items-center justify-center gap-1.5 text-[10px] font-bold text-purple-400 bg-purple-500/10 rounded hover:bg-purple-500/20 hover:text-purple-300 transition-colors">
                                                        <i data-lucide="server" class="w-3 h-3"></i> Liber3
                                                    </a>
                                                    <a href="${libgenLiLink}" target="_blank" class="py-2 flex items-center justify-center gap-1.5 text-[10px] font-bold text-emerald-400 bg-emerald-500/10 rounded hover:bg-emerald-500/20 hover:text-emerald-300 transition-colors">
                                                        <i data-lucide="library" class="w-3 h-3"></i> LibGen
                                                    </a>
                                                </div>
                                            </div>
                                            `;
                                        }).join('')}
                                    </div>
                                ` : state.bookFinder.query ? `
                                    <div class="text-center py-20">
                                        <div class="inline-block p-4 bg-white/5 rounded-full mb-4"><i data-lucide="search-x" class="w-8 h-8 text-slate-500"></i></div>
                                        <p class="text-slate-400">No books found matching "${state.bookFinder.query}"</p>
                                    </div>
                                ` : `
                                    <div class="text-center py-20 opacity-50">
                                        <i data-lucide="library" class="w-12 h-12 mx-auto mb-4 text-emerald-500/30"></i>
                                        <p class="text-slate-500">Search for any book to get started.</p>
                                    </div>
                                `}
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // --- NEW MODAL RENDERERS ---
        function renderNotificationModal() {
            const { show, message, type } = state.notification;
            if (!show) return '';
            
            const isError = type === 'error';
            const colorClass = isError ? 'text-rose-400 bg-rose-500/10 border-rose-500/20' : 'text-emerald-400 bg-emerald-500/10 border-emerald-500/20';
            const icon = isError ? 'alert-triangle' : 'check-circle';

            return `
                <div class="fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/70 backdrop-blur-sm modal-enter">
                    <div class="bg-slate-900 border border-white/10 rounded-2xl p-6 shadow-2xl max-w-sm w-full text-center">
                        <div class="w-12 h-12 rounded-full mx-auto mb-4 flex items-center justify-center ${colorClass}">
                            <i data-lucide="${icon}" class="w-6 h-6"></i>
                        </div>
                        <h3 class="text-lg font-bold text-white mb-2">${isError ? 'Oops!' : 'Success'}</h3>
                        <p class="text-slate-400 text-sm mb-6">${message}</p>
                        <button onclick="closeNotification()" class="w-full py-3 bg-white/10 hover:bg-white/20 text-white rounded-xl text-sm font-bold transition-colors">Okay</button>
                    </div>
                </div>
            `;
        }

        function renderConfirmationModal() {
            const { show, message } = state.confirmation;
            if (!show) return '';

            return `
                <div class="fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/70 backdrop-blur-sm modal-enter">
                    <div class="bg-slate-900 border border-white/10 rounded-2xl p-6 shadow-2xl max-w-sm w-full text-center">
                        <div class="w-12 h-12 rounded-full mx-auto mb-4 flex items-center justify-center text-amber-400 bg-amber-500/10 border border-amber-500/20">
                            <i data-lucide="help-circle" class="w-6 h-6"></i>
                        </div>
                        <h3 class="text-lg font-bold text-white mb-2">Confirm Action</h3>
                        <p class="text-slate-400 text-sm mb-6">${message}</p>
                        <div class="flex gap-3">
                            <button onclick="closeConfirmation()" class="flex-1 py-3 bg-white/5 hover:bg-white/10 text-slate-300 rounded-xl text-sm font-bold transition-colors">Cancel</button>
                            <button onclick="confirmAction()" class="flex-1 py-3 bg-gradient-to-r from-cyan-500 to-blue-600 hover:from-cyan-400 hover:to-blue-500 text-white rounded-xl text-sm font-bold transition-colors">Confirm</button>
                        </div>
                    </div>
                </div>
            `;
        }

        function render() {
            const root = document.getElementById('root');
            const modalRoot = document.getElementById('modal-root');
            
            let focusedId = null;
            let selectionStart = 0;
            let selectionEnd = 0;
            if (document.activeElement && document.activeElement.id) {
                focusedId = document.activeElement.id;
                if (document.activeElement.type === 'text' || document.activeElement.type === 'search' || document.activeElement.tagName === 'INPUT') {
                    selectionStart = document.activeElement.selectionStart;
                    selectionEnd = document.activeElement.selectionEnd;
                }
            }

            const nav = renderNav();
            let content = '';
            if (state.view === 'login') content = renderLogin();
            else if (state.view === 'admin' && state.isAdmin) content = renderAdmin();
            else content = renderHome();

            const footer = `<footer class="relative z-10 mt-12 py-8 text-center text-slate-500 text-xs"><div class="inline-block px-4 py-2 rounded-full bg-white/5 border border-white/5 backdrop-blur-sm">Made by SAWON MUKHERJEE</div></footer>`;
            const floatingBtn = state.view === 'home' ? renderFloatingButton() : '';
            const scrollTopBtn = renderScrollTopButton();

            root.innerHTML = nav + `<main class="relative z-10 max-w-7xl mx-auto px-4 py-8 min-h-[80vh]">${content}</main>` + footer + floatingBtn + scrollTopBtn;
            
            // Modal Rendering Logic
            let modalContent = '';
            if (state.notification.show) {
                modalContent = renderNotificationModal();
            } else if (state.confirmation.show) {
                modalContent = renderConfirmationModal();
            } else if (state.showDriveResultModal) {
                modalContent = renderDriveResultModal(); 
            } else if (state.showDriveModal) {
                modalContent = renderDriveFinderModal();
            } else if (state.showSignatureModal) {
                modalContent = renderSignatureModal();
            } else if (state.showBookModal) {
                modalContent = renderBookSearchModal();
            }
            modalRoot.innerHTML = modalContent;
            
            if (focusedId) { 
                const el = document.getElementById(focusedId); 
                if (el) {
                    el.focus();
                    if (typeof el.setSelectionRange === 'function') {
                        el.setSelectionRange(selectionStart, selectionEnd);
                    }
                } 
            }
            lucide.createIcons();
        }

        // Scroll Listener for Top Button
        window.addEventListener('scroll', () => {
            const btn = document.getElementById('scrollTopBtn');
            if (btn) {
                if (window.scrollY > 300) {
                    btn.classList.remove('opacity-0', 'translate-y-10', 'pointer-events-none');
                    btn.classList.add('opacity-100', 'translate-y-0', 'pointer-events-auto');
                } else {
                    btn.classList.add('opacity-0', 'translate-y-10', 'pointer-events-none');
                    btn.classList.remove('opacity-100', 'translate-y-0', 'pointer-events-auto');
                }
            }
        });

        // Initial Render
        init();
        render();
    </script>
</body>
</html>
