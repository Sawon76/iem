<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IEM'21 KUET - Industrial Study Hub</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Google Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; }
        .animate-fadeIn { animation: fadeIn 0.5s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes pulse-slow { 0%, 100% { opacity: 0.2; } 50% { opacity: 0.5; } }
        .animate-pulse-slow { animation: pulse-slow 4s infinite; }
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: rgba(255, 255, 255, 0.05); }
        ::-webkit-scrollbar-thumb { background: rgba(255, 255, 255, 0.1); border-radius: 4px; }
    </style>
</head>
<body class="bg-[#0f172a] text-slate-200 selection:bg-cyan-500/30 selection:text-cyan-100 min-h-screen overflow-x-hidden relative">

    <!-- Background Effects -->
    <div class="fixed inset-0 z-0 overflow-hidden pointer-events-none">
        <div class="absolute top-[-10%] left-[-10%] w-[50%] h-[50%] bg-purple-600/20 rounded-full blur-[120px] animate-pulse-slow"></div>
        <div class="absolute bottom-[-10%] right-[-10%] w-[50%] h-[50%] bg-cyan-600/20 rounded-full blur-[120px] animate-pulse-slow" style="animation-delay: 2s;"></div>
    </div>

    <!-- Main App Container -->
    <div id="root" class="relative z-10"></div>
    <div id="modal-root" class="relative z-50"></div>

    <script type="module">
        // --- GITHUB CONFIGURATION ---
        // REPLACE THESE VALUES WITH YOUR REPO DETAILS
        const GITHUB_CONFIG = {
            owner: "Sawon76", // e.g., 'sawon-m'
            repo: "iem",        // e.g., 'study-hub-db'
            branch: "main",                // Usually 'main' or 'master'
            dbPath: "data.json"            // The file storing your data
        };

        const apiKey = ""; // Gemini API Key (Runtime provided)

        // --- State ---
        const state = {
            token: localStorage.getItem('gh_token') || null,
            user: null,
            isAdmin: false,
            view: 'home',
            materials: [],
            loading: true,
            filterYear: 'All',
            filterSem: 'All',
            searchSub: '',
            neuralTarget: null,
            
            adminForm: {
                id: null,
                year: '1st Year',
                semester: '1st Semester',
                subject: '',
                teacher: '',
                category: 'Study Material',
                part: 'Part A',
                link: '',
                storageType: 'link', 
                fileData: null,
                fileName: '',
                status: 'IDLE'
            },
            
            neural: { activeTab: 'concepts', content: '', loading: false, data: {} }
        };

        // --- Constants ---
        const YEARS = ['1st Year', '2nd Year', '3rd Year', '4th Year'];
        const SEMESTERS = ['1st Semester', '2nd Semester'];
        const CATEGORIES = ['Study Material', 'Term Questions', 'CT Questions', 'Lab Manual'];
        const PARTS = ['Part A', 'Part B', 'Complete'];

        // --- Initialization ---
        async function init() {
            if (state.token) {
                // Verify token by fetching user
                try {
                    const user = await githubAPI('/user');
                    state.user = user;
                    state.isAdmin = true;
                } catch (e) {
                    console.error("Token invalid", e);
                    localStorage.removeItem('gh_token');
                    state.token = null;
                }
            }
            fetchData();
        }

        // --- GitHub API Helpers ---
        async function githubAPI(endpoint, method = 'GET', body = null) {
            const headers = {
                'Accept': 'application/vnd.github.v3+json',
                ...(state.token && { 'Authorization': `token ${state.token}` })
            };
            
            const options = { method, headers };
            if (body) options.body = JSON.stringify(body);

            const res = await fetch(`https://api.github.com${endpoint}`, options);
            if (!res.ok) throw new Error(`GitHub API Error: ${res.status}`);
            return res.json();
        }

        async function fetchData() {
            state.loading = true;
            render();
            
            try {
                // 1. Try fetching via API (Admin - fresh data)
                if (state.token) {
                    try {
                        const file = await githubAPI(`/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/contents/${GITHUB_CONFIG.dbPath}`);
                        const content = atob(file.content); // Decode Base64
                        state.materials = JSON.parse(content);
                    } catch (e) {
                        // File might not exist yet
                        if (e.message.includes('404')) state.materials = [];
                        else throw e;
                    }
                } 
                // 2. Try fetching Raw (Public - cached but free limit)
                else {
                    const cacheBuster = new Date().getTime(); // Prevent browser caching
                    const url = `https://raw.githubusercontent.com/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/${GITHUB_CONFIG.branch}/${GITHUB_CONFIG.dbPath}?t=${cacheBuster}`;
                    const res = await fetch(url);
                    if (res.ok) {
                        state.materials = await res.json();
                    } else {
                        // If 404, assume empty DB
                        state.materials = [];
                    }
                }
            } catch (err) {
                console.error("Fetch failed:", err);
                // Keep empty array
            } finally {
                state.loading = false;
                render();
            }
        }

        async function saveToGitHub(newMaterials) {
            // 1. Get current file SHA (needed for update)
            let sha = null;
            try {
                const current = await githubAPI(`/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/contents/${GITHUB_CONFIG.dbPath}`);
                sha = current.sha;
            } catch (e) { /* File doesn't exist yet, that's fine */ }

            // 2. Push update
            const content = btoa(JSON.stringify(newMaterials, null, 2)); // Encode Base64
            
            await githubAPI(`/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/contents/${GITHUB_CONFIG.dbPath}`, 'PUT', {
                message: "Update study materials DB",
                content: content,
                sha: sha // Include SHA if updating
            });
        }

        async function uploadFileToGitHub(fileData, fileName) {
            // fileData is data:mime;base64,.....
            // GitHub wants just the base64 part
            const base64Content = fileData.split(',')[1];
            const path = `uploads/${Date.now()}_${fileName.replace(/\s/g, '_')}`; // Unique path

            const res = await githubAPI(`/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/contents/${path}`, 'PUT', {
                message: `Upload ${fileName}`,
                content: base64Content
            });

            // Construct the raw link for the student to download
            // Note: We use the raw link for viewing/downloading
            return `https://raw.githubusercontent.com/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/${GITHUB_CONFIG.branch}/${path}`;
        }

        // --- Actions ---

        window.setView = (view) => { state.view = view; render(); };
        window.setFilter = (k, v) => { state[k] = v; render(); };
        window.updateAdminForm = (k, v) => { state.adminForm[k] = v; render(); };

        window.handleLogin = async (e) => {
            e.preventDefault();
            const token = e.target.token.value.trim();
            if (!token.startsWith('ghp_') && !token.startsWith('github_pat_')) {
                alert("Invalid Token format. It usually starts with 'ghp_'.");
                return;
            }
            
            localStorage.setItem('gh_token', token);
            state.token = token;
            await init(); // Verify token
            if (state.user) {
                state.view = 'admin';
            } else {
                alert("Token verification failed. Check permissions.");
            }
            render();
        };

        window.handleLogout = () => {
            localStorage.removeItem('gh_token');
            state.token = null;
            state.user = null;
            state.isAdmin = false;
            state.view = 'home';
            render();
        };

        window.handleFileSelect = (e) => {
            const file = e.target.files[0];
            if (!file) return;
            // 25MB limit for GitHub API via browser is safer, though API supports 100MB
            if (file.size > 25 * 1024 * 1024) { 
                alert("File too large! GitHub API limits browser uploads. Keep under 25MB.");
                e.target.value = '';
                return;
            }
            const reader = new FileReader();
            reader.onloadend = () => {
                state.adminForm.fileData = reader.result;
                state.adminForm.fileName = file.name;
                render();
            };
            reader.readAsDataURL(file);
        };

        window.handleAdminSubmit = async (e) => {
            e.preventDefault();
            const form = state.adminForm;
            state.adminForm.status = 'UPLOADING';
            render();

            try {
                let downloadUrl = form.link;

                // 1. Handle File Upload if selected
                if (form.storageType === 'file') {
                    if(!form.fileData) throw new Error("No file selected");
                    downloadUrl = await uploadFileToGitHub(form.fileData, form.fileName);
                }

                // 2. Prepare Data Object
                const newItem = {
                    id: form.id || crypto.randomUUID(),
                    year: form.year,
                    semester: form.semester,
                    subject: form.subject,
                    teacher: form.teacher,
                    category: form.category,
                    part: form.part,
                    link: downloadUrl,
                    isFile: form.storageType === 'file',
                    createdAt: new Date().toISOString()
                };

                // 3. Update Local List & Save to DB
                let newMaterials = [...state.materials];
                if (form.id) {
                    const idx = newMaterials.findIndex(m => m.id === form.id);
                    if (idx !== -1) newMaterials[idx] = newItem;
                } else {
                    newMaterials.push(newItem);
                }

                await saveToGitHub(newMaterials);
                
                // Success
                state.materials = newMaterials;
                state.adminForm.status = 'SUCCESS';
                render();
                setTimeout(() => {
                    resetAdminForm();
                    render();
                }, 1500);

            } catch (err) {
                console.error(err);
                alert("Error: " + err.message);
                state.adminForm.status = 'ERROR';
                render();
            }
        };

        window.handleDelete = async (id) => {
            if(!confirm("Are you sure? This removes it from the list (file remains in repo history).")) return;
            
            try {
                const newMaterials = state.materials.filter(m => m.id !== id);
                await saveToGitHub(newMaterials);
                state.materials = newMaterials;
                render();
            } catch (err) {
                alert("Delete Failed: " + err.message);
            }
        };

        window.handleEdit = (id) => {
            const item = state.materials.find(m => m.id === id);
            if (!item) return;
            state.adminForm = { ...state.adminForm, ...item, id: item.id, storageType: item.isFile ? 'file' : 'link', status: 'IDLE' };
            window.scrollTo({top:0, behavior:'smooth'});
            render();
        };

        window.cancelEdit = () => { resetAdminForm(); render(); };

        function resetAdminForm() {
            state.adminForm = {
                id: null, year: YEARS[0], semester: SEMESTERS[0], subject: '', teacher: '', 
                category: 'Study Material', part: 'Part A', link: '', storageType: 'link', 
                fileData: null, fileName: '', status: 'IDLE'
            };
        }

        // --- Rendering ---
        function render() {
            const root = document.getElementById('root');
            
            if (GITHUB_CONFIG.owner === "YOUR_GITHUB_USERNAME") {
                root.innerHTML = renderSetup();
                lucide.createIcons();
                return;
            }

            const nav = renderNav();
            let content = '';
            if (state.view === 'login') content = renderLogin();
            else if (state.view === 'admin' && state.isAdmin) content = renderAdmin();
            else content = renderHome();

            const footer = `
                <footer class="relative z-10 mt-12 py-8 text-center text-slate-500 text-xs">
                    <div class="inline-block px-4 py-2 rounded-full bg-white/5 border border-white/5">
                        Made by SAWON M. • GitHub Powered
                    </div>
                </footer>`;

            root.innerHTML = nav + `<main class="relative z-10 max-w-7xl mx-auto px-4 py-8 min-h-[80vh]">${content}</main>` + footer;
            lucide.createIcons();
        }

        function renderSetup() {
            return `
                <div class="min-h-screen flex items-center justify-center p-4 text-center">
                    <div class="bg-black/40 p-8 rounded-2xl border border-white/10 max-w-lg">
                        <i data-lucide="github" class="w-12 h-12 text-white mx-auto mb-4"></i>
                        <h1 class="text-xl font-bold text-white mb-2">GitHub Setup Required</h1>
                        <p class="text-slate-400 text-sm mb-6">Open the code file and edit the <code>GITHUB_CONFIG</code> object at the top.</p>
                        <div class="text-left bg-black/50 p-4 rounded text-xs font-mono text-cyan-400">
                            const GITHUB_CONFIG = {<br>
                            &nbsp;&nbsp;owner: "your-username",<br>
                            &nbsp;&nbsp;repo: "your-repo-name",<br>
                            &nbsp;&nbsp;...<br>
                            }
                        </div>
                    </div>
                </div>
            `;
        }

        function renderNav() {
            return `
                <nav class="relative z-20 mx-4 mt-4 rounded-2xl bg-white/5 backdrop-blur-xl border border-white/10 shadow-lg shadow-black/20">
                    <div class="max-w-7xl mx-auto px-6">
                        <div class="flex flex-col md:flex-row items-center justify-between min-h-[5rem] py-4 md:py-0 gap-4">
                            <div class="flex items-center gap-3 cursor-pointer" onclick="setView('home')">
                                <div class="p-2 bg-gradient-to-tr from-cyan-500 to-purple-500 rounded-xl shadow-lg">
                                    <i data-lucide="cpu" class="w-6 h-6 text-white"></i>
                                </div>
                                <div class="flex flex-col">
                                    <span class="text-xl font-bold tracking-wide text-transparent bg-clip-text bg-gradient-to-r from-white to-slate-400">IEM'21</span>
                                    <span class="text-[10px] font-bold tracking-[0.2em] text-cyan-400/80">KUET</span>
                                </div>
                            </div>
                            <div class="flex items-center gap-4">
                                <div class="hidden md:flex items-center gap-2 text-xs font-medium text-slate-400 bg-black/20 px-3 py-1 rounded-full border border-white/5">
                                    <div class="w-2 h-2 rounded-full ${state.user ? 'bg-emerald-400 shadow-[0_0_8px_#34d399]' : 'bg-rose-400'}"></div>
                                    ${state.user ? 'ADMIN ONLINE' : 'PUBLIC MODE'}
                                </div>
                                ${state.isAdmin 
                                    ? `<button onclick="handleLogout()" class="px-4 py-2 text-xs font-bold text-rose-300 bg-rose-500/10 border border-rose-500/20 rounded-xl hover:bg-rose-500/20">LOGOUT</button>`
                                    : `<button onclick="setView('login')" class="px-4 py-2 text-xs font-bold text-cyan-300 bg-cyan-500/10 border border-cyan-500/20 rounded-xl hover:bg-cyan-500/20">ADMIN LOGIN</button>`
                                }
                            </div>
                        </div>
                    </div>
                </nav>
            `;
        }

        function renderLogin() {
            return `
                <div class="flex justify-center items-center py-20 animate-fadeIn">
                    <div class="w-full max-w-md bg-white/5 backdrop-blur-2xl border border-white/10 p-8 rounded-3xl shadow-2xl">
                        <div class="text-center mb-8">
                            <div class="inline-block p-4 bg-cyan-500/10 rounded-full border border-cyan-500/20 mb-4"><i data-lucide="key" class="w-8 h-8 text-cyan-400"></i></div>
                            <h2 class="text-2xl font-bold text-white">Admin Authentication</h2>
                            <p class="text-sm text-slate-400 mt-2">Enter your GitHub Personal Access Token (PAT)</p>
                        </div>
                        <form onsubmit="handleLogin(event)" class="space-y-6">
                            <div>
                                <label class="block text-xs font-bold text-slate-300 mb-2 ml-1">GITHUB TOKEN (repo scope)</label>
                                <input name="token" type="password" class="w-full bg-black/40 border border-white/10 text-white p-4 rounded-xl focus:border-cyan-500/50 outline-none" placeholder="ghp_..." required />
                            </div>
                            <div class="flex gap-4">
                                <button type="button" onclick="setView('home')" class="flex-1 py-3 rounded-xl text-sm font-bold text-slate-400 bg-white/5 hover:bg-white/10">CANCEL</button>
                                <button type="submit" class="flex-1 py-3 rounded-xl text-sm font-bold text-white bg-gradient-to-r from-cyan-500 to-blue-600 hover:shadow-lg hover:shadow-cyan-500/20">VERIFY</button>
                            </div>
                        </form>
                    </div>
                </div>
            `;
        }

        function renderAdmin() {
            const f = state.adminForm;
            return `
                <div class="max-w-3xl mx-auto space-y-8 animate-fadeIn">
                    <div class="bg-white/5 backdrop-blur-2xl border border-white/10 rounded-3xl p-6 relative overflow-hidden">
                        <div class="flex items-center justify-between mb-6 pb-4 border-b border-white/10">
                            <div class="flex items-center gap-3">
                                <div class="p-2 bg-emerald-500/20 rounded-lg text-emerald-400"><i data-lucide="${f.id ? 'pencil' : 'upload'}" class="w-5 h-5"></i></div>
                                <h2 class="font-bold text-white">${f.id ? 'Edit Entry' : 'Upload Material'}</h2>
                            </div>
                            ${f.id ? `<button onclick="cancelEdit()" class="text-xs font-bold text-slate-400 hover:text-white flex items-center gap-1"><i data-lucide="x" class="w-3 h-3"></i> CANCEL EDIT</button>` : ''}
                        </div>
                        <form onsubmit="handleAdminSubmit(event)" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <select onchange="updateAdminForm('year', this.value)" class="bg-black/30 border border-white/10 rounded-xl px-4 py-3 text-sm text-slate-200 outline-none">${YEARS.map(y => `<option class="bg-slate-900" ${f.year === y ? 'selected':''}>${y}</option>`).join('')}</select>
                            <select onchange="updateAdminForm('semester', this.value)" class="bg-black/30 border border-white/10 rounded-xl px-4 py-3 text-sm text-slate-200 outline-none">${SEMESTERS.map(s => `<option class="bg-slate-900" ${f.semester === s ? 'selected':''}>${s}</option>`).join('')}</select>
                            
                            <input value="${f.subject}" oninput="updateAdminForm('subject', this.value)" class="md:col-span-2 bg-black/30 border border-white/10 rounded-xl px-4 py-3 text-sm text-slate-200 outline-none" placeholder="Subject Name" required />
                            <input value="${f.teacher}" oninput="updateAdminForm('teacher', this.value)" class="md:col-span-2 bg-black/30 border border-white/10 rounded-xl px-4 py-3 text-sm text-slate-200 outline-none" placeholder="Instructor Name" required />
                            
                            <select onchange="updateAdminForm('category', this.value)" class="bg-black/30 border border-white/10 rounded-xl px-4 py-3 text-sm text-slate-200 outline-none">${CATEGORIES.map(c => `<option class="bg-slate-900" ${f.category === c ? 'selected':''}>${c}</option>`).join('')}</select>
                            <select onchange="updateAdminForm('part', this.value)" class="bg-black/30 border border-white/10 rounded-xl px-4 py-3 text-sm text-slate-200 outline-none">${PARTS.map(p => `<option class="bg-slate-900" ${f.part === p ? 'selected':''}>${p}</option>`).join('')}</select>

                            <div class="md:col-span-2 pt-2 border-t border-white/5">
                                <div class="flex gap-2 mb-3">
                                    <button type="button" onclick="updateAdminForm('storageType', 'link')" class="flex-1 py-2 text-xs font-bold rounded-lg border transition-all ${f.storageType === 'link' ? 'bg-cyan-500/20 border-cyan-500/50 text-cyan-300' : 'border-white/5 text-slate-500'}">EXTERNAL LINK</button>
                                    <button type="button" onclick="updateAdminForm('storageType', 'file')" class="flex-1 py-2 text-xs font-bold rounded-lg border transition-all ${f.storageType === 'file' ? 'bg-purple-500/20 border-purple-500/50 text-purple-300' : 'border-white/5 text-slate-500'}">DIRECT UPLOAD</button>
                                </div>
                                ${f.storageType === 'link' 
                                    ? `<input value="${f.link}" oninput="updateAdminForm('link', this.value)" class="w-full bg-black/30 border border-white/10 rounded-xl px-4 py-3 text-sm text-slate-200 outline-none" placeholder="Paste Google Drive link..." />`
                                    : `<div class="relative"><input type="file" onchange="handleFileSelect(event)" class="w-full bg-black/30 border border-white/10 rounded-xl px-4 py-3 text-sm text-slate-400 file:mr-4 file:py-1 file:px-3 file:rounded-full file:border-0 file:text-xs file:font-bold file:bg-purple-500/20 file:text-purple-300" /></div>`
                                }
                            </div>

                            <button type="submit" ${f.status !== 'IDLE' ? 'disabled' : ''} class="md:col-span-2 py-3 mt-2 rounded-xl text-sm font-bold text-white bg-gradient-to-r from-cyan-500 to-blue-600 hover:shadow-lg hover:shadow-cyan-500/20 transition-all">
                                ${f.status === 'IDLE' ? (f.id ? 'SAVE CHANGES' : 'UPLOAD TO REPO') : `<span class="animate-pulse">${f.status}...</span>`}
                            </button>
                        </form>
                    </div>

                    <div class="bg-white/5 backdrop-blur-2xl border border-white/10 rounded-3xl p-6">
                        <h3 class="text-sm font-bold text-slate-400 mb-4 px-2">DATABASE ENTRIES</h3>
                        <div class="space-y-3 max-h-96 overflow-y-auto pr-2">
                            ${state.materials.map(m => `
                                <div class="flex items-center justify-between p-4 bg-black/20 rounded-xl border border-white/5">
                                    <div>
                                        <div class="font-bold text-slate-200 text-sm">${m.subject}</div>
                                        <div class="text-xs text-slate-500 mt-1">${m.category} • ${m.year}</div>
                                    </div>
                                    <div class="flex gap-2">
                                        <button onclick="handleEdit('${m.id}')" class="p-2 rounded-lg bg-slate-700/30 text-slate-400 hover:text-white"><i data-lucide="pencil" class="w-4 h-4"></i></button>
                                        <button onclick="handleDelete('${m.id}')" class="p-2 rounded-lg bg-rose-500/10 text-rose-400 hover:bg-rose-500/20"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
        }

        function renderHome() {
            const filtered = state.materials.filter(m => {
                const y = state.filterYear === 'All' || m.year === state.filterYear;
                const s = state.filterSem === 'All' || m.semester === state.filterSem;
                const q = state.searchSub.toLowerCase();
                return y && s && (m.subject.toLowerCase().includes(q) || m.teacher.toLowerCase().includes(q));
            });

            return `
                <div class="space-y-8 animate-fadeIn">
                    <div class="bg-white/5 backdrop-blur-xl border border-white/10 p-4 rounded-3xl shadow-xl sticky top-4 z-30">
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                            <select onchange="setFilter('filterYear', this.value)" class="col-span-1 bg-black/30 text-slate-200 h-10 px-3 rounded-xl text-xs outline-none border border-white/5">
                                <option value="All" class="bg-slate-900">All Years</option>
                                ${YEARS.map(y => `<option value="${y}" class="bg-slate-900" ${state.filterYear === y ? 'selected':''}>${y}</option>`).join('')}
                            </select>
                            <select onchange="setFilter('filterSem', this.value)" class="col-span-1 bg-black/30 text-slate-200 h-10 px-3 rounded-xl text-xs outline-none border border-white/5">
                                <option value="All" class="bg-slate-900">All Semesters</option>
                                ${SEMESTERS.map(s => `<option value="${s}" class="bg-slate-900" ${state.filterSem === s ? 'selected':''}>${s}</option>`).join('')}
                            </select>
                            <input oninput="setFilter('searchSub', this.value)" class="col-span-2 md:col-span-2 bg-black/30 text-slate-200 h-10 px-4 rounded-xl text-xs outline-none border border-white/5" placeholder="Search subject..." />
                        </div>
                    </div>

                    ${state.loading ? `<div class="text-center py-20 opacity-50 text-sm tracking-widest text-cyan-400 animate-pulse">SYNCING WITH REPO...</div>` :
                      filtered.length === 0 ? `<div class="text-center py-20 opacity-50 text-slate-500">No materials found.</div>` :
                      `<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                          ${filtered.map(m => `
                            <div class="bg-white/5 border border-white/10 rounded-2xl p-5 hover:border-cyan-500/30 transition-all group relative overflow-hidden">
                                <div class="absolute top-0 left-0 w-1 h-full bg-gradient-to-b from-cyan-500 to-purple-600 opacity-50 group-hover:opacity-100 transition-opacity"></div>
                                <div class="flex justify-between items-start mb-3 pl-2">
                                    <span class="text-[10px] font-bold bg-white/5 px-2 py-1 rounded text-cyan-300 border border-white/10">${m.category}</span>
                                    <span class="text-[10px] text-slate-500">${m.part}</span>
                                </div>
                                <h3 class="font-bold text-white text-lg leading-tight mb-1 pl-2">${m.subject}</h3>
                                <p class="text-xs text-slate-400 pl-2 mb-4 flex items-center gap-2"><i data-lucide="user" class="w-3 h-3"></i> ${m.teacher}</p>
                                
                                <div class="flex gap-2 pl-2 mt-4 pt-4 border-t border-white/5">
                                    <a href="${m.link}" target="_blank" class="flex-1 bg-cyan-500/10 text-cyan-300 text-xs font-bold py-2 rounded-lg flex items-center justify-center gap-2 hover:bg-cyan-500/20 transition-colors">
                                        <i data-lucide="${m.isFile ? 'file-down' : 'external-link'}" class="w-3 h-3"></i> ${m.isFile ? 'DOWNLOAD' : 'LINK'}
                                    </a>
                                </div>
                            </div>
                          `).join('')}
                      </div>`
                    }
                </div>
            `;
        }

        // Init
        init();
        render();
    </script>
</body>
</html>
